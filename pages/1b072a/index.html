<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>《Swift编程语言》- 构造过程 | zhmbo</title>
    <meta name="generator" content="VuePress 1.5.2">
    <link rel="icon" href="/img/favicon.ico">
    <script src="/js/jquery.min.js"></script>
    <script src="/js/MouseClickEffect.js"></script>
    <script src="/js/FooterFish.js"></script>
    <meta name="description" content="zhmbo的技术博客,专注iOS技术分享,iOS,OC,Objective-C,Swift,SwiftUI,Apple,上架,Flutter,OpenGL,Xcode,Github,RxSwift,算法,架构,面试,zhmbo,zb,ZB,zhmbo,jumbo">
    <meta name="keywords" content="zhmbo,zhmbo,zhangbao,zhmbo的技术博客,个人博客,博客搭建,专注iOS技术分享,iOS,iOS进阶,iOS高级,OC,Objective-C,Swift,SwiftUI,Apple,上架,Flutter,OpenGL,Xcode,RxSwift,UIButton,UITableView,网络请求,Github,GithubActions,算法,架构,面试,zb,ZB,zhmbo,jumbo">
    <meta name="baidu-site-verification" content="code-l7ZsTFnxp5">
    <meta name="theme-color" content="#11a8cd">
    <link rel="preload" href="/assets/css/0.styles.8e525da2.css" as="style"><link rel="preload" href="/assets/js/app.f91ba302.js" as="script"><link rel="preload" href="/assets/js/2.dd713b59.js" as="script"><link rel="preload" href="/assets/js/3.069de0ac.js" as="script"><link rel="preload" href="/assets/js/26.192e5aa3.js" as="script"><link rel="prefetch" href="/assets/js/10.eca7f202.js"><link rel="prefetch" href="/assets/js/100.884f2e2c.js"><link rel="prefetch" href="/assets/js/101.77e3c5d7.js"><link rel="prefetch" href="/assets/js/102.fbb46419.js"><link rel="prefetch" href="/assets/js/103.4285ab2f.js"><link rel="prefetch" href="/assets/js/104.b9d45e83.js"><link rel="prefetch" href="/assets/js/105.9af86ee7.js"><link rel="prefetch" href="/assets/js/106.f8baee69.js"><link rel="prefetch" href="/assets/js/107.fa4c186a.js"><link rel="prefetch" href="/assets/js/108.155cdba8.js"><link rel="prefetch" href="/assets/js/11.d5dc511b.js"><link rel="prefetch" href="/assets/js/12.126fd524.js"><link rel="prefetch" href="/assets/js/13.31add050.js"><link rel="prefetch" href="/assets/js/14.8f5927ce.js"><link rel="prefetch" href="/assets/js/15.5d73bb50.js"><link rel="prefetch" href="/assets/js/16.b7715387.js"><link rel="prefetch" href="/assets/js/17.b3336126.js"><link rel="prefetch" href="/assets/js/18.f0bd764d.js"><link rel="prefetch" href="/assets/js/19.7f321d7b.js"><link rel="prefetch" href="/assets/js/20.8a704687.js"><link rel="prefetch" href="/assets/js/21.6c9b4fd0.js"><link rel="prefetch" href="/assets/js/22.ce92c244.js"><link rel="prefetch" href="/assets/js/23.cbae088c.js"><link rel="prefetch" href="/assets/js/24.64936988.js"><link rel="prefetch" href="/assets/js/25.6ff36218.js"><link rel="prefetch" href="/assets/js/27.5d49847d.js"><link rel="prefetch" href="/assets/js/28.865bfa0a.js"><link rel="prefetch" href="/assets/js/29.652b637f.js"><link rel="prefetch" href="/assets/js/30.2d2405ab.js"><link rel="prefetch" href="/assets/js/31.ff15975d.js"><link rel="prefetch" href="/assets/js/32.319807cb.js"><link rel="prefetch" href="/assets/js/33.b87269c8.js"><link rel="prefetch" href="/assets/js/34.2c88022c.js"><link rel="prefetch" href="/assets/js/35.090f353e.js"><link rel="prefetch" href="/assets/js/36.ef1f9b0b.js"><link rel="prefetch" href="/assets/js/37.ba5ce128.js"><link rel="prefetch" href="/assets/js/38.3c99d047.js"><link rel="prefetch" href="/assets/js/39.20a400e2.js"><link rel="prefetch" href="/assets/js/4.39a2702d.js"><link rel="prefetch" href="/assets/js/40.0f612174.js"><link rel="prefetch" href="/assets/js/41.c39b1818.js"><link rel="prefetch" href="/assets/js/42.73cd76fc.js"><link rel="prefetch" href="/assets/js/43.fec22db6.js"><link rel="prefetch" href="/assets/js/44.24cf9514.js"><link rel="prefetch" href="/assets/js/45.1a7bd4ad.js"><link rel="prefetch" href="/assets/js/46.2772e34b.js"><link rel="prefetch" href="/assets/js/47.b4eeef41.js"><link rel="prefetch" href="/assets/js/48.6e849ea1.js"><link rel="prefetch" href="/assets/js/49.e0c5a13d.js"><link rel="prefetch" href="/assets/js/5.5d94312a.js"><link rel="prefetch" href="/assets/js/50.773364d5.js"><link rel="prefetch" href="/assets/js/51.1db99b25.js"><link rel="prefetch" href="/assets/js/52.8c4dc63b.js"><link rel="prefetch" href="/assets/js/53.ebf1abab.js"><link rel="prefetch" href="/assets/js/54.016f21d7.js"><link rel="prefetch" href="/assets/js/55.73199a2d.js"><link rel="prefetch" href="/assets/js/56.3316e67d.js"><link rel="prefetch" href="/assets/js/57.57c6a9d7.js"><link rel="prefetch" href="/assets/js/58.65589959.js"><link rel="prefetch" href="/assets/js/59.abcabc64.js"><link rel="prefetch" href="/assets/js/6.8a416018.js"><link rel="prefetch" href="/assets/js/60.d382d1c3.js"><link rel="prefetch" href="/assets/js/61.c76620c7.js"><link rel="prefetch" href="/assets/js/62.44f03a5b.js"><link rel="prefetch" href="/assets/js/63.92fa470c.js"><link rel="prefetch" href="/assets/js/64.2475bc0a.js"><link rel="prefetch" href="/assets/js/65.e33c22e2.js"><link rel="prefetch" href="/assets/js/66.b213e189.js"><link rel="prefetch" href="/assets/js/67.54079f5f.js"><link rel="prefetch" href="/assets/js/68.9490fd8d.js"><link rel="prefetch" href="/assets/js/69.c9253eff.js"><link rel="prefetch" href="/assets/js/7.369ac24e.js"><link rel="prefetch" href="/assets/js/70.1c59f92a.js"><link rel="prefetch" href="/assets/js/71.3492471a.js"><link rel="prefetch" href="/assets/js/72.cec16c5f.js"><link rel="prefetch" href="/assets/js/73.50e8862b.js"><link rel="prefetch" href="/assets/js/74.086f16c5.js"><link rel="prefetch" href="/assets/js/75.5554210f.js"><link rel="prefetch" href="/assets/js/76.dfb35acc.js"><link rel="prefetch" href="/assets/js/77.440dde49.js"><link rel="prefetch" href="/assets/js/78.22d12fc4.js"><link rel="prefetch" href="/assets/js/79.7805a9b0.js"><link rel="prefetch" href="/assets/js/8.dd8ea451.js"><link rel="prefetch" href="/assets/js/80.0f6e99d9.js"><link rel="prefetch" href="/assets/js/81.775865b4.js"><link rel="prefetch" href="/assets/js/82.b0a6a6bc.js"><link rel="prefetch" href="/assets/js/83.b4431f89.js"><link rel="prefetch" href="/assets/js/84.9266dd31.js"><link rel="prefetch" href="/assets/js/85.6250c179.js"><link rel="prefetch" href="/assets/js/86.8def8d74.js"><link rel="prefetch" href="/assets/js/87.ae604169.js"><link rel="prefetch" href="/assets/js/88.ea0b4861.js"><link rel="prefetch" href="/assets/js/89.86dbd55a.js"><link rel="prefetch" href="/assets/js/9.d1ab447d.js"><link rel="prefetch" href="/assets/js/90.9225e7d0.js"><link rel="prefetch" href="/assets/js/91.f6bbf533.js"><link rel="prefetch" href="/assets/js/92.a7f31cba.js"><link rel="prefetch" href="/assets/js/93.540860df.js"><link rel="prefetch" href="/assets/js/94.2e3d73ab.js"><link rel="prefetch" href="/assets/js/95.e35292b9.js"><link rel="prefetch" href="/assets/js/96.c8174b05.js"><link rel="prefetch" href="/assets/js/97.f7b36c87.js"><link rel="prefetch" href="/assets/js/98.555706b2.js"><link rel="prefetch" href="/assets/js/99.70b5aa9a.js">
    <link rel="stylesheet" href="/assets/css/0.styles.8e525da2.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu have-body-img"><header class="navbar blur"><div class="width-limit"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link"><img src="https://cdn.jsdelivr.net/gh/zhmbo/static@master/img/202407311741918.png" alt="zhmbo" class="logo"> <!----></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/" class="nav-link"><i class="iconfont jumbo-nav-home"></i>
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="iOS" class="dropdown-title"><a href="/ios/" class="link-title"><i class="iconfont jumbo-apple"></i>
      iOS
    </a> <span class="title" style="display:none;"><i class="iconfont jumbo-apple"></i>
      iOS
    </span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>iOS开发精髓</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/3f0170/" class="nav-link"><i class="iconfont undefined"></i>
  介绍
</a></li><li class="dropdown-subitem"><a href="/pages/7354af/" class="nav-link"><i class="iconfont undefined"></i>
  从入门
</a></li><li class="dropdown-subitem"><a href="/pages/1b29d1/" class="nav-link"><i class="iconfont undefined"></i>
  到放弃
</a></li></ul></li><li class="dropdown-item"><h4>iOS充电宝</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/5cb5f0/" class="nav-link"><i class="iconfont undefined"></i>
  SwiftUI
</a></li><li class="dropdown-subitem"><a href="/pages/9e761f/" class="nav-link"><i class="iconfont undefined"></i>
  iOS14
</a></li><li class="dropdown-subitem"><a href="/pages/5e2170/" class="nav-link"><i class="iconfont undefined"></i>
  Xcode12
</a></li><li class="dropdown-subitem"><a href="/pages/554b82/" class="nav-link"><i class="iconfont undefined"></i>
  iOS周边
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Swift" class="dropdown-title"><a href="/swift/" class="link-title"><i class="iconfont jumbo-swift"></i>
      Swift
    </a> <span class="title" style="display:none;"><i class="iconfont jumbo-swift"></i>
      Swift
    </span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/04ed05/" class="nav-link"><i class="iconfont undefined"></i>
  概览
</a></li><li class="dropdown-item"><!----> <a href="/pages/cf2b9a/" class="nav-link"><i class="iconfont undefined"></i>
  欢迎来到Swift
</a></li><li class="dropdown-item"><!----> <a href="/pages/9e2f81/" class="nav-link"><i class="iconfont undefined"></i>
  Swift语法
</a></li><li class="dropdown-item"><!----> <a href="/pages/581348/" class="nav-link"><i class="iconfont undefined"></i>
  语言参考
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="技术" class="dropdown-title"><a href="/technology/" class="link-title"><i class="iconfont jumbo-jishu"></i>
      技术
    </a> <span class="title" style="display:none;"><i class="iconfont jumbo-jishu"></i>
      技术
    </span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/4f2c93/" class="nav-link"><i class="iconfont undefined"></i>
  博客
</a></li><li class="dropdown-item"><!----> <a href="/pages/6cbba7/" class="nav-link"><i class="iconfont undefined"></i>
  Github
</a></li><li class="dropdown-item"><!----> <a href="/pages/d9a627/" class="nav-link"><i class="iconfont undefined"></i>
  CocosCreator
</a></li><li class="dropdown-item"><!----> <a href="/pages/9af5e1/" class="nav-link"><i class="iconfont undefined"></i>
  笔记
</a></li><li class="dropdown-item"><!----> <a href="/pages/46944a/" class="nav-link"><i class="iconfont undefined"></i>
  工具
</a></li><li class="dropdown-item"><!----> <a href="/pages/4b617e/" class="nav-link"><i class="iconfont undefined"></i>
  Android
</a></li><li class="dropdown-item"><!----> <a href="/pages/6ee1a4/" class="nav-link"><i class="iconfont undefined"></i>
  Git
</a></li></ul></div></div><div class="nav-item"><a href="/leaveword/" class="nav-link"><i class="iconfont jumbo-liuyan"></i>
  留言
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title"><i class="iconfont jumbo-suoyin"></i>
      索引
    </a> <span class="title" style="display:none;"><i class="iconfont jumbo-suoyin"></i>
      索引
    </span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link"><i class="iconfont undefined"></i>
  分类
</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link"><i class="iconfont undefined"></i>
  标签
</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link"><i class="iconfont undefined"></i>
  归档
</a></li><li class="dropdown-item"><!----> <a href="/friends/" class="nav-link"><i class="iconfont undefined"></i>
  友链
</a></li><li class="dropdown-item"><!----> <a href="/navigation/" class="nav-link"><i class="iconfont undefined"></i>
  导航
</a></li><li class="dropdown-item"><!----> <a href="/findme/" class="nav-link"><i class="iconfont undefined"></i>
  寻Me
</a></li></ul></div></div> <!----></nav></div></div></header> <div class="sidebar-mask"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="https://cdn.jsdelivr.net/gh/zhmbo/static@master/img/20200919111632.png"> <div class="blogger-info"><h3>@jumbo</h3> <span>an ios developer</span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/blog/" class="nav-link"><i class="iconfont jumbo-nav-home"></i>
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="iOS" class="dropdown-title"><a href="/ios/" class="link-title"><i class="iconfont jumbo-apple"></i>
      iOS
    </a> <span class="title" style="display:none;"><i class="iconfont jumbo-apple"></i>
      iOS
    </span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>iOS开发精髓</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/3f0170/" class="nav-link"><i class="iconfont undefined"></i>
  介绍
</a></li><li class="dropdown-subitem"><a href="/pages/7354af/" class="nav-link"><i class="iconfont undefined"></i>
  从入门
</a></li><li class="dropdown-subitem"><a href="/pages/1b29d1/" class="nav-link"><i class="iconfont undefined"></i>
  到放弃
</a></li></ul></li><li class="dropdown-item"><h4>iOS充电宝</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/5cb5f0/" class="nav-link"><i class="iconfont undefined"></i>
  SwiftUI
</a></li><li class="dropdown-subitem"><a href="/pages/9e761f/" class="nav-link"><i class="iconfont undefined"></i>
  iOS14
</a></li><li class="dropdown-subitem"><a href="/pages/5e2170/" class="nav-link"><i class="iconfont undefined"></i>
  Xcode12
</a></li><li class="dropdown-subitem"><a href="/pages/554b82/" class="nav-link"><i class="iconfont undefined"></i>
  iOS周边
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Swift" class="dropdown-title"><a href="/swift/" class="link-title"><i class="iconfont jumbo-swift"></i>
      Swift
    </a> <span class="title" style="display:none;"><i class="iconfont jumbo-swift"></i>
      Swift
    </span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/04ed05/" class="nav-link"><i class="iconfont undefined"></i>
  概览
</a></li><li class="dropdown-item"><!----> <a href="/pages/cf2b9a/" class="nav-link"><i class="iconfont undefined"></i>
  欢迎来到Swift
</a></li><li class="dropdown-item"><!----> <a href="/pages/9e2f81/" class="nav-link"><i class="iconfont undefined"></i>
  Swift语法
</a></li><li class="dropdown-item"><!----> <a href="/pages/581348/" class="nav-link"><i class="iconfont undefined"></i>
  语言参考
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="技术" class="dropdown-title"><a href="/technology/" class="link-title"><i class="iconfont jumbo-jishu"></i>
      技术
    </a> <span class="title" style="display:none;"><i class="iconfont jumbo-jishu"></i>
      技术
    </span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/4f2c93/" class="nav-link"><i class="iconfont undefined"></i>
  博客
</a></li><li class="dropdown-item"><!----> <a href="/pages/6cbba7/" class="nav-link"><i class="iconfont undefined"></i>
  Github
</a></li><li class="dropdown-item"><!----> <a href="/pages/d9a627/" class="nav-link"><i class="iconfont undefined"></i>
  CocosCreator
</a></li><li class="dropdown-item"><!----> <a href="/pages/9af5e1/" class="nav-link"><i class="iconfont undefined"></i>
  笔记
</a></li><li class="dropdown-item"><!----> <a href="/pages/46944a/" class="nav-link"><i class="iconfont undefined"></i>
  工具
</a></li><li class="dropdown-item"><!----> <a href="/pages/4b617e/" class="nav-link"><i class="iconfont undefined"></i>
  Android
</a></li><li class="dropdown-item"><!----> <a href="/pages/6ee1a4/" class="nav-link"><i class="iconfont undefined"></i>
  Git
</a></li></ul></div></div><div class="nav-item"><a href="/leaveword/" class="nav-link"><i class="iconfont jumbo-liuyan"></i>
  留言
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title"><i class="iconfont jumbo-suoyin"></i>
      索引
    </a> <span class="title" style="display:none;"><i class="iconfont jumbo-suoyin"></i>
      索引
    </span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link"><i class="iconfont undefined"></i>
  分类
</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link"><i class="iconfont undefined"></i>
  标签
</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link"><i class="iconfont undefined"></i>
  归档
</a></li><li class="dropdown-item"><!----> <a href="/friends/" class="nav-link"><i class="iconfont undefined"></i>
  友链
</a></li><li class="dropdown-item"><!----> <a href="/navigation/" class="nav-link"><i class="iconfont undefined"></i>
  导航
</a></li><li class="dropdown-item"><!----> <a href="/findme/" class="nav-link"><i class="iconfont undefined"></i>
  寻Me
</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/pages/04ed05/" class="sidebar-link">概览</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>欢迎来到Swift</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Swift语法</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/9e2f81/" class="sidebar-link">基础知识</a></li><li><a href="/pages/279dd7/" class="sidebar-link">基本运算符</a></li><li><a href="/pages/2850e8/" class="sidebar-link">字符串和字符</a></li><li><a href="/pages/4b4c78/" class="sidebar-link">集合类型</a></li><li><a href="/pages/544cb0/" class="sidebar-link">控制流</a></li><li><a href="/pages/b69d99/" class="sidebar-link">函数</a></li><li><a href="/pages/7904a7/" class="sidebar-link">闭包</a></li><li><a href="/pages/56276f/" class="sidebar-link">枚举</a></li><li><a href="/pages/0641bb/" class="sidebar-link">类和结构体</a></li><li><a href="/pages/ce0459/" class="sidebar-link">属性</a></li><li><a href="/pages/efc653/" class="sidebar-link">方法</a></li><li><a href="/pages/e35887/" class="sidebar-link">下标</a></li><li><a href="/pages/09b0f4/" class="sidebar-link">继承</a></li><li><a href="/pages/1b072a/" aria-current="page" class="active sidebar-link">构造过程</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/1b072a/#存储属性的初始赋值" class="sidebar-link">存储属性的初始赋值</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/1b072a/#构造器" class="sidebar-link">构造器</a></li><li class="sidebar-sub-header"><a href="/pages/1b072a/#默认属性值" class="sidebar-link">默认属性值</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/1b072a/#自定义构造过程" class="sidebar-link">自定义构造过程</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/1b072a/#形参的构造过程" class="sidebar-link">形参的构造过程</a></li><li class="sidebar-sub-header"><a href="/pages/1b072a/#形参命名和实参标签" class="sidebar-link">形参命名和实参标签</a></li><li class="sidebar-sub-header"><a href="/pages/1b072a/#不带实参标签的构造器形参" class="sidebar-link">不带实参标签的构造器形参</a></li><li class="sidebar-sub-header"><a href="/pages/1b072a/#可选属性类型" class="sidebar-link">可选属性类型</a></li><li class="sidebar-sub-header"><a href="/pages/1b072a/#构造过程中常量属性的赋值" class="sidebar-link">构造过程中常量属性的赋值</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/1b072a/#默认构造器" class="sidebar-link">默认构造器</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/1b072a/#结构体的逐一成员构造器" class="sidebar-link">结构体的逐一成员构造器</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/1b072a/#值类型的构造器代理" class="sidebar-link">值类型的构造器代理</a></li><li class="sidebar-sub-header"><a href="/pages/1b072a/#类的继承和构造过程" class="sidebar-link">类的继承和构造过程</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/1b072a/#指定构造器和便利构造器" class="sidebar-link">指定构造器和便利构造器</a></li><li class="sidebar-sub-header"><a href="/pages/1b072a/#指定构造器和便利构造器的语法" class="sidebar-link">指定构造器和便利构造器的语法</a></li><li class="sidebar-sub-header"><a href="/pages/1b072a/#类类型的构造器代理" class="sidebar-link">类类型的构造器代理</a></li><li class="sidebar-sub-header"><a href="/pages/1b072a/#两段式构造过程" class="sidebar-link">两段式构造过程</a></li><li class="sidebar-sub-header"><a href="/pages/1b072a/#构造器的继承和重写" class="sidebar-link">构造器的继承和重写</a></li><li class="sidebar-sub-header"><a href="/pages/1b072a/#构造器的自动继承" class="sidebar-link">构造器的自动继承</a></li><li class="sidebar-sub-header"><a href="/pages/1b072a/#指定构造器和便利构造器实践" class="sidebar-link">指定构造器和便利构造器实践</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/1b072a/#可失败构造器" class="sidebar-link">可失败构造器</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/1b072a/#枚举类型的可失败构造器" class="sidebar-link">枚举类型的可失败构造器</a></li><li class="sidebar-sub-header"><a href="/pages/1b072a/#带原始值的枚举类型的可失败构造器" class="sidebar-link">带原始值的枚举类型的可失败构造器</a></li><li class="sidebar-sub-header"><a href="/pages/1b072a/#构造失败的传递" class="sidebar-link">构造失败的传递</a></li><li class="sidebar-sub-header"><a href="/pages/1b072a/#重写一个可失败构造器" class="sidebar-link">重写一个可失败构造器</a></li><li class="sidebar-sub-header"><a href="/pages/1b072a/#init-可失败构造器" class="sidebar-link">init! 可失败构造器</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/1b072a/#必要构造器" class="sidebar-link">必要构造器</a></li><li class="sidebar-sub-header"><a href="/pages/1b072a/#通过闭包或函数设置属性的默认值" class="sidebar-link">通过闭包或函数设置属性的默认值</a></li></ul></li><li><a href="/pages/c40911/" class="sidebar-link">解析过程</a></li><li><a href="/pages/96b368/" class="sidebar-link">可选链</a></li><li><a href="/pages/cc5b2d/" class="sidebar-link">错误处理</a></li><li><a href="/pages/757c02/" class="sidebar-link">类型转换</a></li><li><a href="/pages/1d43f5/" class="sidebar-link">嵌套类型</a></li><li><a href="/pages/297d1c/" class="sidebar-link">扩展</a></li><li><a href="/pages/82f958/" class="sidebar-link">协议</a></li><li><a href="/pages/0d8a5e/" class="sidebar-link">泛型</a></li><li><a href="/pages/46ff18/" class="sidebar-link">不透明类型</a></li><li><a href="/pages/51a2dd/" class="sidebar-link">自动引用计数</a></li><li><a href="/pages/9224f8/" class="sidebar-link">内存安全</a></li><li><a href="/pages/6c25a0/" class="sidebar-link">访问控制</a></li><li><a href="/pages/9854b9/" class="sidebar-link">高级运算符</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>语言参考</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <div><main class="page"> <div class="theme-vdoing-wrapper bg-style-1"><div class="articleInfo-wrap" data-v-7e90c5a4><div class="articleInfo" data-v-7e90c5a4><ul class="breadcrumbs" data-v-7e90c5a4><li data-v-7e90c5a4><a href="/" title="首页" class="iconfont jumbo-home router-link-active" data-v-7e90c5a4></a></li> <li data-v-7e90c5a4><a href="/categories/?category=Swift%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80" title="分类" data-v-7e90c5a4>Swift编程语言</a></li> <li data-v-7e90c5a4><a href="/categories/?category=Swift%E8%AF%AD%E6%B3%95" title="分类" data-v-7e90c5a4>Swift语法</a></li></ul> <div class="info" data-v-7e90c5a4><div title="作者" class="author iconfont jumbo-author" data-v-7e90c5a4><a href="https://github.com/zhmbo" target="_blank" title="作者" class="beLink" data-v-7e90c5a4>zhmbo</a></div> <div title="创建时间" class="date iconfont jumbo-time" data-v-7e90c5a4><a href="javascript:;" data-v-7e90c5a4>2020-11-10</a></div> <div title="统计" class="date iconfont jumbo-eye" data-v-7e90c5a4><span id="/pages/1b072a/" data-flag-title="《Swift编程语言》- 构造过程" class="leancloud-visitors" data-v-7e90c5a4><a class="leancloud-visitors-count" style="font-size:.7rem;font-weight:normal;color:#999;"></a></span></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABGpJREFUSA3tVVtoXFUU3fvOI53UlmCaKIFmwEhsE7QK0ipFEdHEKpXaZGrp15SINsXUWvBDpBgQRKi0+KKoFeJHfZA+ED9KKoIU2gYD9UejTW4rVIzm0VSTziPzuNu1z507dibTTjL4U/DAzLn3nL3X2o91ziX6f9wMFdh6Jvbm9nNSV0msViVO6tN1Rm7NMu2OpeJ9lWBUTDxrJbYTS0hInuwciu9eLHlFxCLCZEk3MegsJmZ5K/JD6t7FkFdEvGUo1g7qJoG3MHImqRIn8/nzY1K9UPKKiJmtnUqHVE3Gbuay6vJE/N2FEmuxFjW2nUuE0yQXRRxLiTUAzs36zhZvOXJPdX850EVnnLZkB8prodQoM5JGj7Xk2mvC7JB8tG04Ef5PiXtG0UtxupRQSfTnBoCy554x18yJHI6I+G5Eru4LHmPJZEQsrvPUbMiA8G/WgMK7w7I+ez7++o2ANfbrjvaOl1tFMs+htG3IrZH9/hDX1Pr8Tc0UvH8tcX29KzAgIGcEkINyW5BF9x891hw6VYqgJHEk0huccS7vh3C6gTiODL+26huuBtbct8eZnqLML8PkxGYpuPZBqtqwkSjgc4mB5gbgig5i+y0UDK35LMxXisn9xQtK+nd26gTIHsHe/oblK/b29fUmN/8Y+9jAQrnBp56m1LcDlDp9irKTExSKduXJVWSqdBMA08pEJnEIOB3FPPMybu/oeV8zFeYN3xx576Q6RH+VmplE4ncQV5v+5rzSoyOU7PuEAg8g803PwBJ0CExno/jcMbN8tONYeOmHiuUNryvm3fRUy4tMPVLdAGkUhNWuggGrJcXPv+ouCjz0MKUHz1J2/E8IC9nqTabcxgaBYM0hPhD5Y65FsbxRQKxCQrDjDctW7PUM3HuZunFyifSAqEfuzCp48Il24luWUWZoyJCaPR82jE0+kFA643wRFVni4RYSq3ohJO2pZ7B5dO4xkDWbEpossJPLSrPjYID8rS2UHTlvyNxqIGsg674XJJ7vnh5L7PNwC4hh2sjCI96mzszOTpxLF0T7l88Yz7lAuK6OnL8gXLOnTvpzSb22YG8W7us3jSebFHeeqnXRG1vt+MoUM84LQIBmMsCTAcOauTh0T0l0neQK7m2bLMt2mGxU3HYssS0J2cdv5wljlPsrIuZLAG/2DOZIXgCYT8uMGZN+e2kSirfxZOPCsC0f24nTZzspnVn9VePS1Z5vubmAGGXG8ZFno9Hel0yfA5ZPhF7Dh972BQJ2qCpgH67lmWtBYbvk6sz02wjky2vXyz0XErP/kFB619js1BtwfOV4OPRqOQBjy3Qbk18vigUPPSD5ceHnwck7W9bhAqZdd7SuG7w4/P2F/GaJh8c7e9qgow+Q7cGBo+98WsLkuktFqiZabtXuQTu/Y5ETbR0v7tNSFnvrmu6pjdoan2KjMu8q/Hmj1EfCO2ZGfEIbIXKUlw8qaX9/b2oeSJmFksSeT/Fn0V3nSypChh4Gjh74ybO9aeZ/AN2dwciu2/MhAAAAAElFTkSuQmCC">
          《Swift编程语言》- 构造过程
        </h1> <div class="theme-vdoing-content content__default"><p><em>构造过程</em>是使用类、结构体或枚举类型的实例之前的准备过程。在新实例使用前有个过程是必须的，它包括设置实例中每个存储属性的初始值和执行其他必须的设置或构造过程。</p> <p>你要通过定义<em>构造器</em>来实现构造过程，它就像用来创建特定类型新实例的特殊方法。与 Objective-C 中的构造器不同，Swift 的构造器没有返回值。它们的主要任务是保证某种类型的新实例在第一次使用前完成正确的初始化。</p> <p>类的实例也可以通过实现<em>析构器</em>来执行它释放之前自定义的清理工作。想了解更多关于析构器的内容，请参 考 <a href="/pages/c40911/">析构过程</a>。</p> <h2 id="存储属性的初始赋值"><a href="#存储属性的初始赋值" class="header-anchor">#</a> 存储属性的初始赋值</h2> <p>类和结构体在创建实例时，必须为所有存储型属性设置合适的初始值。存储型属性的值不能处于一个未知的状态。</p> <p>你可以在构造器中为存储型属性设置初始值，也可以在定义属性时分配默认值。以下小节将详细介绍这两种方法。</p> <blockquote><p>注意</p> <p>当你为存储型属性分配默认值或者在构造器中设置初始值时，它们的值是被直接设置的，不会触发任何属性观察者。</p></blockquote> <h3 id="构造器"><a href="#构造器" class="header-anchor">#</a> 构造器</h3> <p>构造器在创建某个特定类型的新实例时被调用。它的最简形式类似于一个不带任何形参的实例方法，以关键字 <code>init</code> 命名：</p> <div class="language-swift line-numbers-mode"><pre class="language-swift"><code><span class="token keyword">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 在此处执行构造过程</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>下面例子中定义了一个用来保存华氏温度的结构体 <code>Fahrenheit</code>，它拥有一个 <code>Double</code> 类型的存储型属性 <code>temperature</code>：</p> <div class="language-swift line-numbers-mode"><pre class="language-swift"><code><span class="token keyword">struct</span> <span class="token class-name">Fahrenheit</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> temperature<span class="token punctuation">:</span> <span class="token class-name">Double</span>
    <span class="token keyword">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        temperature <span class="token operator">=</span> <span class="token number">32.0</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> f <span class="token operator">=</span> <span class="token class-name">Fahrenheit</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;The default temperature is </span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">f<span class="token punctuation">.</span>temperature</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">° Fahrenheit&quot;</span></span><span class="token punctuation">)</span>
<span class="token comment">// 打印“The default temperature is 32.0° Fahrenheit”</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>这个结构体定义了一个不带形参的构造器 <code>init</code>，并在里面将存储型属性 <code>temperature</code> 的值初始化为 <code>32.0</code>（华氏温度下水的冰点）。</p> <h3 id="默认属性值"><a href="#默认属性值" class="header-anchor">#</a> 默认属性值</h3> <p>如前所述，你可以在构造器中为存储型属性设置初始值。同样，你也可以在属性声明时为其设置默认值。</p> <blockquote><p>注意</p> <p>如果一个属性总是使用相同的初始值，那么为其设置一个默认值比每次都在构造器中赋值要好。两种方法的最终结果是一样的，只不过使用默认值让属性的初始化和声明结合得更紧密。它能让你的构造器更简洁、更清晰，且能通过默认值自动推导出属性的类型；同时，它也能让你充分利用默认构造器、构造器继承等特性，后续章节将讲到。</p></blockquote> <p>你可以通过在属性声明时为 <code>temperature</code> 提供默认值来使用更简单的方式定义结构体 <code>Fahrenheit</code> ：</p> <div class="language-swift line-numbers-mode"><pre class="language-swift"><code><span class="token keyword">struct</span> <span class="token class-name">Fahrenheit</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> temperature <span class="token operator">=</span> <span class="token number">32.0</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h2 id="自定义构造过程"><a href="#自定义构造过程" class="header-anchor">#</a> 自定义构造过程</h2> <p>你可以通过输入形参和可选属性类型来自定义构造过程，也可以在构造过程中分配常量属性。这些都将在后面章节中提到。</p> <h3 id="形参的构造过程"><a href="#形参的构造过程" class="header-anchor">#</a> 形参的构造过程</h3> <p>自定义构造过程时，可以在定义中提供<em>构造形参</em>，指定其值的类型和名字。构造形参的功能和语法跟函数和方法的形参相同。</p> <p>下面例子中定义了一个用来保存摄氏温度的结构体 <code>Celsius</code>。它定义了两个不同的构造器：<code>init(fromFahrenheit:)</code> 和 <code>init(fromKelvin:)</code>，二者分别通过接受不同温标下的温度值来创建新的实例：</p> <div class="language-swift line-numbers-mode"><pre class="language-swift"><code><span class="token keyword">struct</span> <span class="token class-name">Celsius</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> temperatureInCelsius<span class="token punctuation">:</span> <span class="token class-name">Double</span>
    <span class="token keyword">init</span><span class="token punctuation">(</span>fromFahrenheit fahrenheit<span class="token punctuation">:</span> <span class="token class-name">Double</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        temperatureInCelsius <span class="token operator">=</span> <span class="token punctuation">(</span>fahrenheit <span class="token operator">-</span> <span class="token number">32.0</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">1.8</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">init</span><span class="token punctuation">(</span>fromKelvin kelvin<span class="token punctuation">:</span> <span class="token class-name">Double</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        temperatureInCelsius <span class="token operator">=</span> kelvin <span class="token operator">-</span> <span class="token number">273.15</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>


<span class="token keyword">let</span> boilingPointOfWater <span class="token operator">=</span> <span class="token class-name">Celsius</span><span class="token punctuation">(</span>fromFahrenheit<span class="token punctuation">:</span> <span class="token number">212.0</span><span class="token punctuation">)</span>
<span class="token comment">// boilingPointOfWater.temperatureInCelsius 是 100.0</span>
<span class="token keyword">let</span> freezingPointOfWater <span class="token operator">=</span> <span class="token class-name">Celsius</span><span class="token punctuation">(</span>fromKelvin<span class="token punctuation">:</span> <span class="token number">273.15</span><span class="token punctuation">)</span>
<span class="token comment">// freezingPointOfWater.temperatureInCelsius 是 0.0</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>第一个构造器拥有一个构造形参，其实参标签为 <code>fromFahrenheit</code>，形参命名为 <code>fahrenheit</code>；第二个构造器也拥有一个构造形参，其实参标签为 <code>fromKelvin</code>，形参命名为 <code>kelvin</code>。这两个构造器都将单一的实参转换成摄氏温度值，并保存在属性 <code>temperatureInCelsius</code> 中。</p> <h3 id="形参命名和实参标签"><a href="#形参命名和实参标签" class="header-anchor">#</a> 形参命名和实参标签</h3> <p>跟函数和方法形参相同，构造形参可以同时使用在构造器里使用的形参命名和一个外部调用构造器时使用的实参标签。</p> <p>然而，构造器并不像函数和方法那样在括号前有一个可辨别的方法名。因此在调用构造器时，主要通过构造器中形参命名和类型来确定应该被调用的构造器。正因如此，如果你在定义构造器时没有提供实参标签，Swift 会为构造器的<em>每个</em>形参自动生成一个实参标签。</p> <p>以下例子中定义了一个结构体 <code>Color</code>，它包含了三个常量：<code>red</code>、<code>green</code> 和 <code>blue</code>。这些属性可以存储 <code>0.0</code> 到 <code>1.0</code> 之间的值，用来表明颜色中红、绿、蓝成分的含量。</p> <p><code>Color</code> 提供了一个构造器，为红蓝绿提供三个合适 <code>Double</code> 类型的形参命名。<code>Color</code> 也提供了第二个构造器，它只包含名为 <code>white</code> 的 <code>Double</code> 类型的形参，它为三个颜色的属性提供相同的值。</p> <div class="language-swift line-numbers-mode"><pre class="language-swift"><code><span class="token keyword">struct</span> <span class="token class-name">Color</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> red<span class="token punctuation">,</span> green<span class="token punctuation">,</span> blue<span class="token punctuation">:</span> <span class="token class-name">Double</span>
    <span class="token keyword">init</span><span class="token punctuation">(</span>red<span class="token punctuation">:</span> <span class="token class-name">Double</span><span class="token punctuation">,</span> green<span class="token punctuation">:</span> <span class="token class-name">Double</span><span class="token punctuation">,</span> blue<span class="token punctuation">:</span> <span class="token class-name">Double</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span>red   <span class="token operator">=</span> red
        <span class="token keyword">self</span><span class="token punctuation">.</span>green <span class="token operator">=</span> green
        <span class="token keyword">self</span><span class="token punctuation">.</span>blue  <span class="token operator">=</span> blue
    <span class="token punctuation">}</span>
    <span class="token keyword">init</span><span class="token punctuation">(</span>white<span class="token punctuation">:</span> <span class="token class-name">Double</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        red   <span class="token operator">=</span> white
        green <span class="token operator">=</span> white
        blue  <span class="token operator">=</span> white
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>两种构造器都能通过为每一个构造器形参提供命名值来创建一个新的 <code>Color</code> 实例：</p> <div class="language-swift line-numbers-mode"><pre class="language-swift"><code><span class="token keyword">let</span> magenta <span class="token operator">=</span> <span class="token class-name">Color</span><span class="token punctuation">(</span>red<span class="token punctuation">:</span> <span class="token number">1.0</span><span class="token punctuation">,</span> green<span class="token punctuation">:</span> <span class="token number">0.0</span><span class="token punctuation">,</span> blue<span class="token punctuation">:</span> <span class="token number">1.0</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> halfGray <span class="token operator">=</span> <span class="token class-name">Color</span><span class="token punctuation">(</span>white<span class="token punctuation">:</span> <span class="token number">0.5</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>注意，如果不通过实参标签传值，这个构造器是没法调用的。如果构造器定义了某个实参标签，就必须使用它，忽略它将导致编译期错误：</p> <div class="language-swift line-numbers-mode"><pre class="language-swift"><code><span class="token keyword">let</span> veryGreen <span class="token operator">=</span> <span class="token class-name">Color</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">)</span>
<span class="token comment">// 报编译期错误-需要实参标签</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="不带实参标签的构造器形参"><a href="#不带实参标签的构造器形参" class="header-anchor">#</a> 不带实参标签的构造器形参</h3> <p>如果你不希望构造器的某个形参使用实参标签，可以使用下划线（<code>_</code>）来代替显式的实参标签来重写默认行为。</p> <p>下面是之前 <a href="#%E5%BD%A2%E5%8F%82%E7%9A%84%E6%9E%84%E9%80%A0%E8%BF%87%E7%A8%8B">形参的构造过程</a> 中 <code>Celsius</code> 例子的扩展，多了一个用已经的摄氏表示的 <code>Double</code> 类型值来创建新的 <code>Celsius</code> 实例的额外构造器：</p> <div class="language-swift line-numbers-mode"><pre class="language-swift"><code><span class="token keyword">struct</span> <span class="token class-name">Celsius</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> temperatureInCelsius<span class="token punctuation">:</span> <span class="token class-name">Double</span>
    <span class="token keyword">init</span><span class="token punctuation">(</span>fromFahrenheit fahrenheit<span class="token punctuation">:</span> <span class="token class-name">Double</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        temperatureInCelsius <span class="token operator">=</span> <span class="token punctuation">(</span>fahrenheit <span class="token operator">-</span> <span class="token number">32.0</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">1.8</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">init</span><span class="token punctuation">(</span>fromKelvin kelvin<span class="token punctuation">:</span> <span class="token class-name">Double</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        temperatureInCelsius <span class="token operator">=</span> kelvin <span class="token operator">-</span> <span class="token number">273.15</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">init</span><span class="token punctuation">(</span><span class="token omit keyword">_</span> celsius<span class="token punctuation">:</span> <span class="token class-name">Double</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        temperatureInCelsius <span class="token operator">=</span> celsius
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>


<span class="token keyword">let</span> bodyTemperature <span class="token operator">=</span> <span class="token class-name">Celsius</span><span class="token punctuation">(</span><span class="token number">37.0</span><span class="token punctuation">)</span>
<span class="token comment">// bodyTemperature.temperatureInCelsius 为 37.0</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>构造器调用 <code>Celsius(37.0)</code> 意图明确，不需要实参标签。因此适合使用 <code>init(_ celsius: Double)</code> 这样的构造器，从而可以通过提供未命名的 <code>Double</code> 值来调用构造器。</p> <h3 id="可选属性类型"><a href="#可选属性类型" class="header-anchor">#</a> 可选属性类型</h3> <p>如果你自定义的类型有一个逻辑上允许值为空的存储型属性——无论是因为它无法在初始化时赋值，还是因为它在之后某个时机可以赋值为空——都需要将它声明为 <code>可选类型</code>。可选类型的属性将自动初始化为 <code>nil</code>，表示这个属性是特意在构造过程设置为空。</p> <p>下面例子中定义了类 <code>SurveyQuestion</code>，它包含一个可选 <code>String</code> 属性 <code>response</code>：</p> <div class="language-swift line-numbers-mode"><pre class="language-swift"><code><span class="token keyword">class</span> <span class="token class-name">SurveyQuestion</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> text<span class="token punctuation">:</span> <span class="token class-name">String</span>
    <span class="token keyword">var</span> response<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token operator">?</span>
    <span class="token keyword">init</span><span class="token punctuation">(</span>text<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span>text <span class="token operator">=</span> text
    <span class="token punctuation">}</span>
    <span class="token keyword">func</span> <span class="token function-definition function">ask</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">print</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>


<span class="token keyword">let</span> cheeseQuestion <span class="token operator">=</span> <span class="token class-name">SurveyQuestion</span><span class="token punctuation">(</span>text<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">&quot;Do you like cheese?&quot;</span></span><span class="token punctuation">)</span>
cheeseQuestion<span class="token punctuation">.</span><span class="token function">ask</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">// 打印“Do you like cheese?”</span>
cheeseQuestion<span class="token punctuation">.</span>response <span class="token operator">=</span> <span class="token string-literal"><span class="token string">&quot;Yes, I do like cheese.&quot;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>调查问题的答案在询问前是无法确定的，因此我们将属性 <code>response</code> 声明为 <code>String?</code> 类型，或者说是 “可选类型 <code>String</code>“。当 <code>SurveyQuestion</code> 的实例初始化时，它将自动赋值为 <code>nil</code>，表明“暂时还没有字符“。</p> <h3 id="构造过程中常量属性的赋值"><a href="#构造过程中常量属性的赋值" class="header-anchor">#</a> 构造过程中常量属性的赋值</h3> <p>你可以在构造过程中的任意时间点给常量属性赋值，只要在构造过程结束时它设置成确定的值。一旦常量属性被赋值，它将永远不可更改。</p> <blockquote><p>注意</p> <p>对于类的实例来说，它的常量属性只能在定义它的类的构造过程中修改；不能在子类中修改。</p></blockquote> <p>你可以修改上面的 <code>SurveyQuestion</code> 示例，用常量属性替代变量属性 <code>text</code>，表示问题内容 <code>text</code> 在 <code>SurveyQuestion</code> 的实例被创建之后不会再被修改。尽管 <code>text</code> 属性现在是常量，我们仍然可以在类的构造器中设置它的值：</p> <div class="language-swift line-numbers-mode"><pre class="language-swift"><code><span class="token keyword">class</span> <span class="token class-name">SurveyQuestion</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> text<span class="token punctuation">:</span> <span class="token class-name">String</span>
    <span class="token keyword">var</span> response<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token operator">?</span>
    <span class="token keyword">init</span><span class="token punctuation">(</span>text<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span>text <span class="token operator">=</span> text
    <span class="token punctuation">}</span>
    <span class="token keyword">func</span> <span class="token function-definition function">ask</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">print</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">let</span> beetsQuestion <span class="token operator">=</span> <span class="token class-name">SurveyQuestion</span><span class="token punctuation">(</span>text<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">&quot;How about beets?&quot;</span></span><span class="token punctuation">)</span>
beetsQuestion<span class="token punctuation">.</span><span class="token function">ask</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">// 打印“How about beets?”</span>
beetsQuestion<span class="token punctuation">.</span>response <span class="token operator">=</span> <span class="token string-literal"><span class="token string">&quot;I also like beets. (But not with cheese.)&quot;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h2 id="默认构造器"><a href="#默认构造器" class="header-anchor">#</a> 默认构造器</h2> <p>如果结构体或类为所有属性提供了默认值，又没有提供任何自定义的构造器，那么 Swift 会给这些结构体或类提供一个<em>默认构造器</em>。这个默认构造器将简单地创建一个所有属性值都设置为它们默认值的实例。</p> <p>下面例子中定义了一个类 <code>ShoppingListItem</code>，它封装了购物清单中的某一物品的名字（<code>name</code>）、数量（<code>quantity</code>）和购买状态 <code>purchase state</code>：</p> <div class="language-swift line-numbers-mode"><pre class="language-swift"><code><span class="token keyword">class</span> <span class="token class-name">ShoppingListItem</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> name<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token operator">?</span>
    <span class="token keyword">var</span> quantity <span class="token operator">=</span> <span class="token number">1</span>
    <span class="token keyword">var</span> purchased <span class="token operator">=</span> <span class="token boolean">false</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> item <span class="token operator">=</span> <span class="token class-name">ShoppingListItem</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>由于 <code>ShoppingListItem</code> 类中的所有属性都有默认值，且它是没有父类的基类，它将自动获得一个将为所有属性设置默认值的并创建实例的默认构造器（由于 <code>name</code> 属性是可选 <code>String</code> 类型，它将接收一个默认 <code>nil</code> 的默认值，尽管代码中没有写出这个值）。上面例子中使用默认构造器创造了一个 <code>ShoppingListItem</code> 类的实例（使用 <code>ShoppingListItem()</code> 形式的构造器语法），并将其赋值给变量 <code>item</code>。</p> <h3 id="结构体的逐一成员构造器"><a href="#结构体的逐一成员构造器" class="header-anchor">#</a> 结构体的逐一成员构造器</h3> <p>结构体如果没有定义任何自定义构造器，它们将自动获得一个<em>逐一成员构造器（memberwise initializer）</em> 。不像默认构造器，即使存储型属性没有默认值，结构体也能会获得逐一成员构造器。</p> <p>逐一成员构造器是用来初始化结构体新实例里成员属性的快捷方法。新实例的属性初始值可以通过名字传入逐一成员构造器中。</p> <p>下面例子中定义了一个结构体 <code>Size</code>，它包含两个属性 <code>width</code> 和 <code>height</code>。根据这两个属性默认赋值为 <code>0.0</code> ，它们的类型被推断出来为 <code>Double</code>。</p> <p>结构体 <code>Size</code> 自动获得了一个逐一成员构造器 <code>init(width:height:)</code>。你可以用它来创建新的 Size 实例：</p> <div class="language-swift line-numbers-mode"><pre class="language-swift"><code><span class="token keyword">struct</span> <span class="token class-name">Size</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> width <span class="token operator">=</span> <span class="token number">0.0</span><span class="token punctuation">,</span> height <span class="token operator">=</span> <span class="token number">0.0</span>
<span class="token punctuation">}</span>
<span class="token keyword">let</span> twoByTwo <span class="token operator">=</span> <span class="token class-name">Size</span><span class="token punctuation">(</span>width<span class="token punctuation">:</span> <span class="token number">2.0</span><span class="token punctuation">,</span> height<span class="token punctuation">:</span> <span class="token number">2.0</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>当你调用一个逐一成员构造器（memberwise initializer）时，可以省略任何一个有默认值的属性。在上面这个例子中，<code>Size</code> 结构体的 <code>height</code> 和 <code>width</code> 属性各有一个默认值。你可以省略两者或两者之一，对于被省略的属性，构造器会使用默认值。举个例子：</p> <div class="language-swift line-numbers-mode"><pre class="language-swift"><code><span class="token keyword">let</span> zeroByTwo <span class="token operator">=</span> <span class="token class-name">Size</span><span class="token punctuation">(</span>height<span class="token punctuation">:</span> <span class="token number">2.0</span><span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span>zeroByTwo<span class="token punctuation">.</span>width<span class="token punctuation">,</span> zeroByTwo<span class="token punctuation">.</span>height<span class="token punctuation">)</span>
<span class="token comment">// 打印 &quot;0.0 2.0&quot;</span>


<span class="token keyword">let</span> zeroByZero <span class="token operator">=</span> <span class="token class-name">Size</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span>zeroByZero<span class="token punctuation">.</span>width<span class="token punctuation">,</span> zeroByZero<span class="token punctuation">.</span>height<span class="token punctuation">)</span>
<span class="token comment">// 打印 &quot;0.0 0.0&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h2 id="值类型的构造器代理"><a href="#值类型的构造器代理" class="header-anchor">#</a> 值类型的构造器代理</h2> <p>构造器可以通过调用其它构造器来完成实例的部分构造过程。这一过程称为<em>构造器代理</em>，它能避免多个构造器间的代码重复。</p> <p>构造器代理的实现规则和形式在值类型和类类型中有所不同。值类型（结构体和枚举类型）不支持继承，所以构造器代理的过程相对简单，因为它们只能代理给自己的其它构造器。类则不同，它可以继承自其它类（请参考 <a href="/pages/09b0f4/">继承</a>）。这意味着类有责任保证其所有继承的存储型属性在构造时也能正确的初始化。这些责任将在后续章节 <a href="#%E7%B1%BB%E7%9A%84%E7%BB%A7%E6%89%BF%E5%92%8C%E6%9E%84%E9%80%A0%E8%BF%87%E7%A8%8B">类的继承和构造过程</a> 中介绍。</p> <p>对于值类型，你可以使用 <code>self.init</code> 在自定义的构造器中引用相同类型中的其它构造器。并且你只能在构造器内部调用 <code>self.init</code>。</p> <p>请注意，如果你为某个值类型定义了一个自定义的构造器，你将无法访问到默认构造器（如果是结构体，还将无法访问逐一成员构造器）。这种限制避免了在一个更复杂的构造器中做了额外的重要设置，但有人不小心使用自动生成的构造器而导致错误的情况。</p> <blockquote><p>注意</p> <p>假如你希望默认构造器、逐一成员构造器以及你自己的自定义构造器都能用来创建实例，可以将自定义的构造器写到扩展（<code>extension</code>）中，而不是写在值类型的原始定义中。想查看更多内容，请查看 <a href="/pages/297d1c/">扩展</a> 章节。</p></blockquote> <p>下面例子定义一个自定义结构体 <code>Rect</code>，用来代表几何矩形。这个例子需要两个辅助的结构体 <code>Size</code> 和 <code>Point</code>，它们各自为其所有的属性提供了默认初始值 <code>0.0</code>。</p> <div class="language-swift line-numbers-mode"><pre class="language-swift"><code><span class="token keyword">struct</span> <span class="token class-name">Size</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> width <span class="token operator">=</span> <span class="token number">0.0</span><span class="token punctuation">,</span> height <span class="token operator">=</span> <span class="token number">0.0</span>
<span class="token punctuation">}</span>


<span class="token keyword">struct</span> <span class="token class-name">Point</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> x <span class="token operator">=</span> <span class="token number">0.0</span><span class="token punctuation">,</span> y <span class="token operator">=</span> <span class="token number">0.0</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>你可以通过以下三种方式为 <code>Rect</code> 创建实例——使用含有默认值的 <code>origin</code> 和 <code>size</code> 属性来初始化；提供指定的 <code>origin</code> 和 <code>size</code> 实例来初始化；提供指定的 <code>center</code> 和 <code>size</code> 来初始化。在下面 <code>Rect</code> 结构体定义中，我们为这三种方式提供了三个自定义的构造器：</p> <div class="language-swift line-numbers-mode"><pre class="language-swift"><code><span class="token keyword">struct</span> <span class="token class-name">Rect</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> origin <span class="token operator">=</span> <span class="token class-name">Point</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">var</span> size <span class="token operator">=</span> <span class="token class-name">Size</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>


    <span class="token keyword">init</span><span class="token punctuation">(</span>origin<span class="token punctuation">:</span> <span class="token class-name">Point</span><span class="token punctuation">,</span> size<span class="token punctuation">:</span> <span class="token class-name">Size</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span>origin <span class="token operator">=</span> origin
        <span class="token keyword">self</span><span class="token punctuation">.</span>size <span class="token operator">=</span> size
    <span class="token punctuation">}</span>


    <span class="token keyword">init</span><span class="token punctuation">(</span>center<span class="token punctuation">:</span> <span class="token class-name">Point</span><span class="token punctuation">,</span> size<span class="token punctuation">:</span> <span class="token class-name">Size</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> originX <span class="token operator">=</span> center<span class="token punctuation">.</span>x <span class="token operator">-</span> <span class="token punctuation">(</span>size<span class="token punctuation">.</span>width <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span>
        <span class="token keyword">let</span> originY <span class="token operator">=</span> center<span class="token punctuation">.</span>y <span class="token operator">-</span> <span class="token punctuation">(</span>size<span class="token punctuation">.</span>height <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token keyword">init</span><span class="token punctuation">(</span>origin<span class="token punctuation">:</span> <span class="token class-name">Point</span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> originX<span class="token punctuation">,</span> y<span class="token punctuation">:</span> originY<span class="token punctuation">)</span><span class="token punctuation">,</span> size<span class="token punctuation">:</span> size<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>第一个 <code>Rect</code> 构造器 <code>init()</code>，在功能上跟没有自定义构造器时自动获得的默认构造器是一样的。这个构造器是函数体是空的，使用一对大括号 <code>{}</code> 来表示。调用这个构造器将返回一个 <code>Rect</code> 实例，它的 <code>origin</code> 和 <code>size</code> 属性都使用定义时的默认值 <code>Point(x: 0.0, y: 0.0)</code> 和 <code>Size(width: 0.0, height: 0.0)</code>：</p> <div class="language-swift line-numbers-mode"><pre class="language-swift"><code><span class="token keyword">let</span> basicRect <span class="token operator">=</span> <span class="token class-name">Rect</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">// basicRect 的 origin 是 (0.0, 0.0)，size 是 (0.0, 0.0)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>第二个 <code>Rect</code> 构造器 <code>init(origin:size:)</code>，在功能上跟结构体在没有自定义构造器时获得的逐一成员构造器是一样的。这个构造器只是简单地将 <code>origin</code> 和 <code>size</code> 的实参值赋给对应的存储型属性：</p> <div class="language-swift line-numbers-mode"><pre class="language-swift"><code><span class="token keyword">let</span> originRect <span class="token operator">=</span> <span class="token class-name">Rect</span><span class="token punctuation">(</span>origin<span class="token punctuation">:</span> <span class="token class-name">Point</span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> <span class="token number">2.0</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">2.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    size<span class="token punctuation">:</span> <span class="token class-name">Size</span><span class="token punctuation">(</span>width<span class="token punctuation">:</span> <span class="token number">5.0</span><span class="token punctuation">,</span> height<span class="token punctuation">:</span> <span class="token number">5.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">// originRect 的 origin 是 (2.0, 2.0)，size 是 (5.0, 5.0)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>第三个 <code>Rect</code> 构造器 <code>init(center:size:)</code> 稍微复杂一点。它先通过 <code>center</code> 和 <code>size</code> 的值计算出 <code>origin</code> 的坐标，然后再调用（或者说代理给）<code>init(origin:size:)</code> 构造器来将新的 <code>origin</code> 和 <code>size</code> 值赋值到对应的属性中：</p> <div class="language-swift line-numbers-mode"><pre class="language-swift"><code><span class="token keyword">let</span> centerRect <span class="token operator">=</span> <span class="token class-name">Rect</span><span class="token punctuation">(</span>center<span class="token punctuation">:</span> <span class="token class-name">Point</span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> <span class="token number">4.0</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">4.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    size<span class="token punctuation">:</span> <span class="token class-name">Size</span><span class="token punctuation">(</span>width<span class="token punctuation">:</span> <span class="token number">3.0</span><span class="token punctuation">,</span> height<span class="token punctuation">:</span> <span class="token number">3.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">// centerRect 的 origin 是 (2.5, 2.5)，size 是 (3.0, 3.0)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>构造器 <code>init(center:size:)</code> 可以直接将 <code>origin</code> 和 <code>size</code> 的新值赋值到对应的属性中。然而，构造器 <code>init(center:size:)</code> 通过使用提供了相关功能的现有构造器将会更加便捷（而且意图更清晰）。</p> <blockquote><p>注意</p> <p>如果你想用另外一种不需要自己定义 <code>init()</code> 和 <code>init(origin:size:)</code> 的方式来实现这个例子，请参考 <a href="/pages/297d1c/">扩展</a>。</p></blockquote> <h2 id="类的继承和构造过程"><a href="#类的继承和构造过程" class="header-anchor">#</a> 类的继承和构造过程</h2> <p>类里面的所有存储型属性——包括所有继承自父类的属性——都<em>必须</em>在构造过程中设置初始值。</p> <p>Swift 为类类型提供了两种构造器来确保实例中所有存储型属性都能获得初始值，它们被称为指定构造器和便利构造器。</p> <h3 id="指定构造器和便利构造器"><a href="#指定构造器和便利构造器" class="header-anchor">#</a> 指定构造器和便利构造器</h3> <p><em>指定构造器</em>是类中最主要的构造器。一个指定构造器将初始化类中提供的所有属性，并调用合适的父类构造器让构造过程沿着父类链继续往上进行。</p> <p>类倾向于拥有极少的指定构造器，普遍的是一个类只拥有一个指定构造器。指定构造器像一个个“漏斗”放在构造过程发生的地方，让构造过程沿着父类链继续往上进行。</p> <p>每一个类都必须至少拥有一个指定构造器。在某些情况下，许多类通过继承了父类中的指定构造器而满足了这个条件。具体内容请参考后续章节 <a href="#%E6%9E%84%E9%80%A0%E5%99%A8%E7%9A%84%E8%87%AA%E5%8A%A8%E7%BB%A7%E6%89%BF">构造器的自动继承</a>。</p> <p><em>便利构造器</em>是类中比较次要的、辅助型的构造器。你可以定义便利构造器来调用同一个类中的指定构造器，并为部分形参提供默认值。你也可以定义便利构造器来创建一个特殊用途或特定输入值的实例。</p> <p>你应当只在必要的时候为类提供便利构造器，比方说某种情况下通过使用便利构造器来快捷调用某个指定构造器，能够节省更多开发时间并让类的构造过程更清晰明了。</p> <h3 id="指定构造器和便利构造器的语法"><a href="#指定构造器和便利构造器的语法" class="header-anchor">#</a> 指定构造器和便利构造器的语法</h3> <p>类的指定构造器的写法跟值类型简单构造器一样：</p> <div class="language-swift line-numbers-mode"><pre class="language-swift"><code><span class="token keyword">init</span><span class="token punctuation">(</span>parameters<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    statements
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>便利构造器也采用相同样式的写法，但需要在 <code>init</code> 关键字之前放置 <code>convenience</code> 关键字，并使用空格将它们俩分开：</p> <div class="language-swift line-numbers-mode"><pre class="language-swift"><code><span class="token keyword">convenience</span> <span class="token keyword">init</span><span class="token punctuation">(</span>parameters<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    statements
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="类类型的构造器代理"><a href="#类类型的构造器代理" class="header-anchor">#</a> 类类型的构造器代理</h3> <p>为了简化指定构造器和便利构造器之间的调用关系，Swift 构造器之间的代理调用遵循以下三条规则：</p> <h4 id="规则-1"><a href="#规则-1" class="header-anchor">#</a> 规则 1</h4> <p>指定构造器必须调用其直接父类的的指定构造器。</p> <h4 id="规则-2"><a href="#规则-2" class="header-anchor">#</a> 规则 2</h4> <p>便利构造器必须调用<em>同</em>类中定义的其它构造器。</p> <h4 id="规则-3"><a href="#规则-3" class="header-anchor">#</a> 规则 3</h4> <p>便利构造器最后必须调用指定构造器。</p> <p>一个更方便记忆的方法是：</p> <ul><li>指定构造器必须总是<em>向上</em>代理</li> <li>便利构造器必须总是<em>横向</em>代理</li></ul> <p>这些规则可以通过下面图例来说明：</p> <p><img src="https://cdn.jsdelivr.net/gh/zhmbo/static@master/img/20201111104738.png" alt="img"></p> <p>构造器代理图</p> <p>如图所示，父类中包含一个指定构造器和两个便利构造器。其中一个便利构造器调用了另外一个便利构造器，而后者又调用了唯一的指定构造器。这满足了上面提到的规则 2 和 3。这个父类没有自己的父类，所以规则 1 没有用到。</p> <p>子类中包含两个指定构造器和一个便利构造器。便利构造器必须调用两个指定构造器中的任意一个，因为它只能调用同一个类里的其他构造器。这满足了上面提到的规则 2 和 3。而两个指定构造器必须调用父类中唯一的指定构造器，这满足了规则 1。</p> <blockquote><p>注意</p> <p>这些规则不会影响类的实例如何创建。任何上图中展示的构造器都可以用来创建完全初始化的实例。这些规则只影响类的构造器如何实现。</p></blockquote> <p>下面图例中展示了一种涉及四个类的更复杂的类层级结构。它演示了指定构造器是如何在类层级中充当“漏斗”的作用，在类的构造器链上简化了类之间的相互关系。</p> <p><img src="https://cdn.jsdelivr.net/gh/zhmbo/static@master/img/20201111104806.png" alt="img"></p> <p>复杂构造器代理图</p> <h3 id="两段式构造过程"><a href="#两段式构造过程" class="header-anchor">#</a> 两段式构造过程</h3> <p>Swift 中类的构造过程包含两个阶段。第一个阶段，类中的每个存储型属性赋一个初始值。当每个存储型属性的初始值被赋值后，第二阶段开始，它给每个类一次机会，在新实例准备使用之前进一步自定义它们的存储型属性。</p> <p>两段式构造过程的使用让构造过程更安全，同时在整个类层级结构中给予了每个类完全的灵活性。两段式构造过程可以防止属性值在初始化之前被访问，也可以防止属性被另外一个构造器意外地赋予不同的值。</p> <blockquote><p>注意</p> <p>Swift 的两段式构造过程跟 Objective-C 中的构造过程类似。最主要的区别在于阶段 1，Objective-C 给每一个属性赋值 <code>0</code> 或空值（比如说 <code>0</code> 或 <code>nil</code>）。Swift 的构造流程则更加灵活，它允许你设置定制的初始值，并自如应对某些属性不能以 <code>0</code> 或 <code>nil</code> 作为合法默认值的情况。</p></blockquote> <p>Swift 编译器将执行 4 种有效的安全检查，以确保两段式构造过程不出错地完成：</p> <h4 id="安全检查-1"><a href="#安全检查-1" class="header-anchor">#</a> 安全检查 1</h4> <p>指定构造器必须保证它所在类的所有属性都必须先初始化完成，之后才能将其它构造任务向上代理给父类中的构造器。</p> <p>如上所述，一个对象的内存只有在其所有存储型属性确定之后才能完全初始化。为了满足这一规则，指定构造器必须保证它所在类的属性在它往上代理之前先完成初始化。</p> <h4 id="安全检查-2"><a href="#安全检查-2" class="header-anchor">#</a> 安全检查 2</h4> <p>指定构造器必须在为继承的属性设置新值之前向上代理调用父类构造器。如果没这么做，指定构造器赋予的新值将被父类中的构造器所覆盖。</p> <h4 id="安全检查-3"><a href="#安全检查-3" class="header-anchor">#</a> 安全检查 3</h4> <p>便利构造器必须为任意属性（包括所有同类中定义的）赋新值之前代理调用其它构造器。如果没这么做，便利构造器赋予的新值将被该类的指定构造器所覆盖。</p> <h4 id="安全检查-4"><a href="#安全检查-4" class="header-anchor">#</a> 安全检查 4</h4> <p>构造器在第一阶段构造完成之前，不能调用任何实例方法，不能读取任何实例属性的值，不能引用 <code>self</code> 作为一个值。</p> <p>类的实例在第一阶段结束以前并不是完全有效的。只有第一阶段完成后，类的实例才是有效的，才能访问属性和调用方法。</p> <p>以下是基于上述安全检查的两段式构造过程展示：</p> <h4 id="阶段-1"><a href="#阶段-1" class="header-anchor">#</a> 阶段 1</h4> <ul><li>类的某个指定构造器或便利构造器被调用。</li> <li>完成类的新实例内存的分配，但此时内存还没有被初始化。</li> <li>指定构造器确保其所在类引入的所有存储型属性都已赋初值。存储型属性所属的内存完成初始化。</li> <li>指定构造器切换到父类的构造器，对其存储属性完成相同的任务。</li> <li>这个过程沿着类的继承链一直往上执行，直到到达继承链的最顶部。</li> <li>当到达了继承链最顶部，而且继承链的最后一个类已确保所有的存储型属性都已经赋值，这个实例的内存被认为已经完全初始化。此时阶段 1 完成。</li></ul> <h4 id="阶段-2"><a href="#阶段-2" class="header-anchor">#</a> 阶段 2</h4> <ul><li>从继承链顶部往下，继承链中每个类的指定构造器都有机会进一步自定义实例。构造器此时可以访问 <code>self</code>、修改它的属性并调用实例方法等等。</li> <li>最终，继承链中任意的便利构造器有机会自定义实例和使用 <code>self</code>。</li></ul> <p>下图展示了在假定的子类和父类之间的构造阶段 1：</p> <p><img src="https://cdn.jsdelivr.net/gh/zhmbo/static@master/img/20201111104818.png" alt="img"></p> <p>构建过程阶段1</p> <p>在这个例子中，构造过程从对子类中一个便利构造器的调用开始。这个便利构造器此时还不能修改任何属性，它会代理到该类中的指定构造器。</p> <p>如安全检查 1 所示，指定构造器将确保所有子类的属性都有值。然后它将调用父类的指定构造器，并沿着继承链一直往上完成父类的构造过程。</p> <p>父类中的指定构造器确保所有父类的属性都有值。由于没有更多的父类需要初始化，也就无需继续向上代理。</p> <p>一旦父类中所有属性都有了初始值，实例的内存被认为是完全初始化，阶段 1 完成。</p> <p>以下展示了相同构造过程的阶段 2：</p> <p><img src="https://cdn.jsdelivr.net/gh/zhmbo/static@master/img/20201111104831.png" alt="img"></p> <p>构建过程阶段2</p> <p>父类中的指定构造器现在有机会进一步自定义实例（尽管这不是必须的）。</p> <p>一旦父类中的指定构造器完成调用，子类中的指定构造器可以执行更多的自定义操作（这也不是必须的）。</p> <p>最终，一旦子类的指定构造器完成调用，最开始被调用的便利构造器可以执行更多的自定义操作。</p> <h3 id="构造器的继承和重写"><a href="#构造器的继承和重写" class="header-anchor">#</a> 构造器的继承和重写</h3> <p>跟 Objective-C 中的子类不同，Swift 中的子类默认情况下不会继承父类的构造器。Swift 的这种机制可以防止一个父类的简单构造器被一个更精细的子类继承，而在用来创建子类时的新实例时没有完全或错误被初始化。</p> <blockquote><p>注意</p> <p>父类的构造器仅会在安全和适当的某些情况下被继承。具体内容请参考后续章节 <a href="#%E6%9E%84%E9%80%A0%E5%99%A8%E7%9A%84%E8%87%AA%E5%8A%A8%E7%BB%A7%E6%89%BF">构造器的自动继承</a>。</p></blockquote> <p>假如你希望自定义的子类中能提供一个或多个跟父类相同的构造器，你可以在子类中提供这些构造器的自定义实现。</p> <p>当你在编写一个和父类中指定构造器相匹配的子类构造器时，你实际上是在重写父类的这个指定构造器。因此，你必须在定义子类构造器时带上 <code>override</code> 修饰符。即使你重写的是系统自动提供的默认构造器，也需要带上 <code>override</code> 修饰符，具体内容请参考 <a href="/pages/1b072a/#默认构造器">默认构造器</a>。</p> <p>正如重写属性，方法或者是下标，<code>override</code> 修饰符会让编译器去检查父类中是否有相匹配的指定构造器，并验证构造器参数是否被按预想中被指定。</p> <blockquote><p>注意</p> <p>当你重写一个父类的指定构造器时，你总是需要写 <code>override</code> 修饰符，即使是为了实现子类的便利构造器。</p></blockquote> <p>相反，如果你编写了一个和父类便利构造器相匹配的子类构造器，由于子类不能直接调用父类的便利构造器（每个规则都在上文 <a href="#%E7%B1%BB%E7%9A%84%E6%9E%84%E9%80%A0%E5%99%A8%E4%BB%A3%E7%90%86%E8%A7%84%E5%88%99">类的构造器代理规则</a> 有所描述），因此，严格意义上来讲，你的子类并未对一个父类构造器提供重写。最后的结果就是，你在子类中“重写”一个父类便利构造器时，不需要加 <code>override</code> 修饰符。</p> <p>在下面的例子中定义了一个叫 <code>Vehicle</code> 的基类。基类中声明了一个存储型属性 <code>numberOfWheels</code>，它是默认值为 <code>Int</code> 类型的 <code>0</code>。<code>numberOfWheels</code> 属性用在一个描述车辆特征 <code>String</code> 类型为 <code>descrpiption</code> 的计算型属性中：</p> <div class="language-swift line-numbers-mode"><pre class="language-swift"><code><span class="token keyword">class</span> <span class="token class-name">Vehicle</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> numberOfWheels <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">var</span> description<span class="token punctuation">:</span> <span class="token class-name">String</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string-literal"><span class="token string">&quot;</span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">numberOfWheels</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string"> wheel(s)&quot;</span></span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><code>Vehicle</code> 类只为存储型属性提供默认值，也没有提供自定义构造器。因此，它会自动获得一个默认构造器，具体内容请参考 <a href="/pages/1b072a/#默认构造器">默认构造器</a>。默认构造器（如果有的话）总是类中的指定构造器，可以用于创建 <code>numberOfWheels</code> 为 <code>0</code> 的 <code>Vehicle</code> 实例：</p> <div class="language-swift line-numbers-mode"><pre class="language-swift"><code><span class="token keyword">let</span> vehicle <span class="token operator">=</span> <span class="token class-name">Vehicle</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;Vehicle: </span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">vehicle<span class="token punctuation">.</span>description</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
<span class="token comment">// Vehicle: 0 wheel(s)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>下面例子中定义了一个 <code>Vehicle</code> 的子类 <code>Bicycle</code>：</p> <div class="language-swift line-numbers-mode"><pre class="language-swift"><code><span class="token keyword">class</span> <span class="token class-name">Bicycle</span><span class="token punctuation">:</span> <span class="token class-name">Vehicle</span> <span class="token punctuation">{</span>
    <span class="token keyword">override</span> <span class="token keyword">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token keyword">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        numberOfWheels <span class="token operator">=</span> <span class="token number">2</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>子类 <code>Bicycle</code> 定义了一个自定义指定构造器 <code>init()</code>。这个指定构造器和父类的指定构造器相匹配，所以 <code>Bicycle</code> 中这个版本的构造器需要带上 <code>override</code> 修饰符。</p> <p><code>Bicycle</code> 的构造器 <code>init()</code> 以调用 <code>super.init()</code> 方法开始，这个方法的作用是调用 <code>Bicycle</code> 的父类 <code>Vehicle</code> 的默认构造器。这样可以确保 <code>Bicycle</code> 在修改属性之前，它所继承的属性 <code>numberOfWheels</code> 能被 <code>Vehicle</code> 类初始化。在调用 <code>super.init()</code> 之后，属性 <code>numberOfWheels</code> 的原值被新值 <code>2</code> 替换。</p> <p>如果你创建一个 <code>Bicycle</code> 实例，你可以调用继承的 <code>description</code> 计算型属性去查看属性 <code>numberOfWheels</code> 是否有改变：</p> <div class="language-swift line-numbers-mode"><pre class="language-swift"><code><span class="token keyword">let</span> bicycle <span class="token operator">=</span> <span class="token class-name">Bicycle</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;Bicycle: </span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">bicycle<span class="token punctuation">.</span>description</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
<span class="token comment">// 打印“Bicycle: 2 wheel(s)”</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>如果子类的构造器没有在阶段 2 过程中做自定义操作，并且父类有一个无参数的指定构造器，你可以在所有子类的存储属性赋值之后省略 <code>super.init()</code> 的调用。</p> <p>这个例子定义了另一个 <code>Vehicle</code> 的子类 <code>Hoverboard</code> ，只设置它的 <code>color</code> 属性。这个构造器依赖隐式调用父类的构造器来完成，而不是显示调用 <code>super.init()</code>。</p> <div class="language-swift line-numbers-mode"><pre class="language-swift"><code><span class="token keyword">class</span> <span class="token class-name">Hoverboard</span><span class="token punctuation">:</span> <span class="token class-name">Vehicle</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> color<span class="token punctuation">:</span> <span class="token class-name">String</span>
    <span class="token keyword">init</span><span class="token punctuation">(</span>color<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span>color <span class="token operator">=</span> color
        <span class="token comment">// super.init() 在这里被隐式调用</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">override</span> <span class="token keyword">var</span> description<span class="token punctuation">:</span> <span class="token class-name">String</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string-literal"><span class="token string">&quot;</span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation"><span class="token keyword">super</span><span class="token punctuation">.</span>description</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string"> in a beautiful </span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">color</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">&quot;</span></span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p><code>Hoverboard</code> 的实例用 <code>Vehicle</code> 构造器里默认的轮子数量。</p> <div class="language-swift line-numbers-mode"><pre class="language-swift"><code><span class="token keyword">let</span> hoverboard <span class="token operator">=</span> <span class="token class-name">Hoverboard</span><span class="token punctuation">(</span>color<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">&quot;silver&quot;</span></span><span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;Hoverboard: </span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">hoverboard<span class="token punctuation">.</span>description</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
<span class="token comment">// Hoverboard: 0 wheel(s) in a beautiful silver</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><blockquote><p>注意</p> <p>子类可以在构造过程修改继承来的变量属性，但是不能修改继承来的常量属性。</p></blockquote> <h3 id="构造器的自动继承"><a href="#构造器的自动继承" class="header-anchor">#</a> 构造器的自动继承</h3> <p>如上所述，子类在默认情况下不会继承父类的构造器。但是如果满足特定条件，父类构造器是可以被自动继承的。事实上，这意味着对于许多常见场景你不必重写父类的构造器，并且可以在安全的情况下以最小的代价继承父类的构造器。</p> <p>假设你为子类中引入的所有新属性都提供了默认值，以下 2 个规则将适用：</p> <h4 id="规则-1-2"><a href="#规则-1-2" class="header-anchor">#</a> 规则 1</h4> <p>如果子类没有定义任何指定构造器，它将自动继承父类所有的指定构造器。</p> <h4 id="规则-2-2"><a href="#规则-2-2" class="header-anchor">#</a> 规则 2</h4> <p>如果子类提供了所有父类指定构造器的实现——无论是通过规则 1 继承过来的，还是提供了自定义实现——它将自动继承父类所有的便利构造器。</p> <p>即使你在子类中添加了更多的便利构造器，这两条规则仍然适用。</p> <blockquote><p>注意</p> <p>子类可以将父类的指定构造器实现为便利构造器来满足规则 2。</p></blockquote> <h3 id="指定构造器和便利构造器实践"><a href="#指定构造器和便利构造器实践" class="header-anchor">#</a> 指定构造器和便利构造器实践</h3> <p>接下来的例子将在实践中展示指定构造器、便利构造器以及构造器的自动继承。这个例子定义了包含三个类 <code>Food</code>、<code>RecipeIngredient</code> 以及 <code>ShoppingListItem</code> 的层级结构，并将演示它们的构造器是如何相互作用的。</p> <p>类层次中的基类是 <code>Food</code>，它是一个简单的用来封装食物名字的类。<code>Food</code> 类引入了一个叫做 <code>name</code> 的 <code>String</code> 类型的属性，并且提供了两个构造器来创建 <code>Food</code> 实例：</p> <div class="language-swift line-numbers-mode"><pre class="language-swift"><code><span class="token keyword">class</span> <span class="token class-name">Food</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> name<span class="token punctuation">:</span> <span class="token class-name">String</span>
    <span class="token keyword">init</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name
    <span class="token punctuation">}</span>


    <span class="token keyword">convenience</span> <span class="token keyword">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token keyword">init</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">&quot;[Unnamed]&quot;</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>下图中展示了 <code>Food</code> 的构造器链：</p> <p><img src="https://cdn.jsdelivr.net/gh/zhmbo/static@master/img/20201111104846.png" alt="img"></p> <p>Food 构造器链</p> <p>类类型没有默认的逐一成员构造器，所以 <code>Food</code> 类提供了一个接受单一参数 <code>name</code> 的指定构造器。这个构造器可以使用一个特定的名字来创建新的 <code>Food</code> 实例：</p> <div class="language-swift line-numbers-mode"><pre class="language-swift"><code><span class="token keyword">let</span> namedMeat <span class="token operator">=</span> <span class="token class-name">Food</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">&quot;Bacon&quot;</span></span><span class="token punctuation">)</span>
<span class="token comment">// namedMeat 的名字是 &quot;Bacon&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><code>Food</code> 类中的构造器 <code>init(name: String)</code> 被定义为一个指定构造器，因为它能确保 <code>Food</code> 实例的所有存储型属性都被初始化。<code>Food</code> 类没有父类，所以 <code>init(name: String)</code> 构造器不需要调用 <code>super.init()</code> 来完成构造过程。</p> <p><code>Food</code> 类同样提供了一个没有参数的便利构造器 <code>init()</code>。这个 <code>init()</code> 构造器为新食物提供了一个默认的占位名字，通过横向代理到指定构造器 <code>init(name: String)</code> 并给参数 <code>name</code> 赋值为 <code>[Unnamed]</code> 来实现：</p> <div class="language-swift line-numbers-mode"><pre class="language-swift"><code><span class="token keyword">let</span> mysteryMeat <span class="token operator">=</span> <span class="token class-name">Food</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">// mysteryMeat 的名字是 [Unnamed]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>层级中的第二个类是 <code>Food</code> 的子类 <code>RecipeIngredient</code>。<code>RecipeIngredient</code> 类用来表示食谱中的一项原料。它引入了 <code>Int</code> 类型的属性 <code>quantity</code>（以及从 <code>Food</code> 继承过来的 <code>name</code> 属性），并且定义了两个构造器来创建 <code>RecipeIngredient</code> 实例：</p> <div class="language-swift line-numbers-mode"><pre class="language-swift"><code><span class="token keyword">class</span> <span class="token class-name">RecipeIngredient</span><span class="token punctuation">:</span> <span class="token class-name">Food</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> quantity<span class="token punctuation">:</span> <span class="token class-name">Int</span>
    <span class="token keyword">init</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span> quantity<span class="token punctuation">:</span> <span class="token class-name">Int</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span>quantity <span class="token operator">=</span> quantity
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token keyword">init</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> name<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">override</span> <span class="token keyword">convenience</span> <span class="token keyword">init</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token keyword">init</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> name<span class="token punctuation">,</span> quantity<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>下图中展示了 <code>RecipeIngredient</code> 类的构造器链：</p> <p><img src="https://cdn.jsdelivr.net/gh/zhmbo/static@master/img/20201111104858.png" alt="img"></p> <p>RecipeIngredient 构造器</p> <p><code>RecipeIngredient</code> 类拥有一个指定构造器 <code>init(name: String, quantity: Int)</code>，它可以用来填充 <code>RecipeIngredient</code> 实例的所有属性值。这个构造器一开始先将传入的 <code>quantity</code> 实参赋值给 <code>quantity</code> 属性，这个属性也是唯一在 <code>RecipeIngredient</code> 中新引入的属性。随后，构造器向上代理到父类 <code>Food</code> 的 <code>init(name: String)</code>。这个过程满足 <a href="#%E4%B8%A4%E6%AE%B5%E5%BC%8F%E6%9E%84%E9%80%A0%E8%BF%87%E7%A8%8B">两段式构造过程</a> 中的安全检查 1。</p> <p><code>RecipeIngredient</code> 也定义了一个便利构造器 <code>init(name: String)</code>，它只通过 <code>name</code> 来创建 <code>RecipeIngredient</code> 的实例。这个便利构造器假设任意 <code>RecipeIngredient</code> 实例的 <code>quantity</code> 为 <code>1</code>，所以不需要显式的质量即可创建出实例。这个便利构造器的定义可以更加方便和快捷地创建实例，并且避免了创建多个 <code>quantity</code> 为 <code>1</code> 的 <code>RecipeIngredient</code> 实例时的代码重复。这个便利构造器只是简单地横向代理到类中的指定构造器，并为 <code>quantity</code> 参数传递 <code>1</code>。</p> <p><code>RecipeIngredient</code> 的便利构造器 <code>init(name: String)</code> 使用了跟 <code>Food</code> 中指定构造器 <code>init(name: String)</code> 相同的形参。由于这个便利构造器重写了父类的指定构造器 <code>init(name: String)</code>，因此必须在前面使用 <code>override</code> 修饰符（参见 <a href="#%E6%9E%84%E9%80%A0%E5%99%A8%E7%9A%84%E7%BB%A7%E6%89%BF%E5%92%8C%E9%87%8D%E5%86%99">构造器的继承和重写</a>）。</p> <p>尽管 <code>RecipeIngredient</code> 将父类的指定构造器重写为了便利构造器，但是它依然提供了父类的所有指定构造器的实现。因此，<code>RecipeIngredient</code> 会自动继承父类的所有便利构造器。</p> <p>在这个例子中，<code>RecipeIngredient</code> 的父类是 <code>Food</code>，它有一个便利构造器 <code>init()</code>。这个便利构造器会被 <code>RecipeIngredient</code> 继承。这个继承版本的 <code>init()</code> 在功能上跟 <code>Food</code> 提供的版本是一样的，只是它会代理到 <code>RecipeIngredient</code> 版本的 <code>init(name: String)</code> 而不是 <code>Food</code> 提供的版本。</p> <p>所有的这三种构造器都可以用来创建新的 <code>RecipeIngredient</code> 实例：</p> <div class="language-swift line-numbers-mode"><pre class="language-swift"><code><span class="token keyword">let</span> oneMysteryItem <span class="token operator">=</span> <span class="token class-name">RecipeIngredient</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> oneBacon <span class="token operator">=</span> <span class="token class-name">RecipeIngredient</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">&quot;Bacon&quot;</span></span><span class="token punctuation">)</span>
<span class="token keyword">let</span> sixEggs <span class="token operator">=</span> <span class="token class-name">RecipeIngredient</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">&quot;Eggs&quot;</span></span><span class="token punctuation">,</span> quantity<span class="token punctuation">:</span> <span class="token number">6</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>类层级中第三个也是最后一个类是 <code>RecipeIngredient</code> 的子类，叫做 <code>ShoppingListItem</code>。这个类构建了购物单中出现的某一种食谱原料。</p> <p>购物单中的每一项总是从未购买状态开始的。为了呈现这一事实，<code>ShoppingListItem</code> 引入了一个 Boolean（布尔类型） 的属性 <code>purchased</code>，它的默认值是 <code>false</code>。<code>ShoppingListItem</code> 还添加了一个计算型属性 <code>description</code>，它提供了关于 <code>ShoppingListItem</code> 实例的一些文字描述：</p> <div class="language-swift line-numbers-mode"><pre class="language-swift"><code><span class="token keyword">class</span> <span class="token class-name">ShoppingListItem</span><span class="token punctuation">:</span> <span class="token class-name">RecipeIngredient</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> purchased <span class="token operator">=</span> <span class="token boolean">false</span>
    <span class="token keyword">var</span> description<span class="token punctuation">:</span> <span class="token class-name">String</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> output <span class="token operator">=</span> <span class="token string-literal"><span class="token string">&quot;</span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">quantity</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string"> x </span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">name</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">&quot;</span></span>
        output <span class="token operator">+=</span> purchased <span class="token operator">?</span> <span class="token string-literal"><span class="token string">&quot; ✔&quot;</span></span> <span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">&quot; ✘&quot;</span></span>
        <span class="token keyword">return</span> output
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><blockquote><p>注意</p> <p><code>ShoppingListItem</code> 没有定义构造器来为 <code>purchased</code> 提供初始值，因为添加到购物单的物品的初始状态总是未购买。</p></blockquote> <p>因为它为自己引入的所有属性都提供了默认值，并且自己没有定义任何构造器，<code>ShoppingListItem</code> 将自动继承所有父类中的指定构造器和便利构造器。</p> <p>下图展示了这三个类的构造器链：</p> <p><img src="https://cdn.jsdelivr.net/gh/zhmbo/static@master/img/20201111104911.png" alt="img"></p> <p>三类构造器图</p> <p>你可以使用三个继承来的构造器来创建 <code>ShoppingListItem</code> 的新实例：</p> <div class="language-swift line-numbers-mode"><pre class="language-swift"><code><span class="token keyword">var</span> breakfastList <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token class-name">ShoppingListItem</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token class-name">ShoppingListItem</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">&quot;Bacon&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token class-name">ShoppingListItem</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">&quot;Eggs&quot;</span></span><span class="token punctuation">,</span> quantity<span class="token punctuation">:</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>
breakfastList<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string-literal"><span class="token string">&quot;Orange juice&quot;</span></span>
breakfastList<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>purchased <span class="token operator">=</span> <span class="token boolean">true</span>
<span class="token keyword">for</span> item <span class="token keyword">in</span> breakfastList <span class="token punctuation">{</span>
    <span class="token function">print</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>description<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">// 1 x orange juice ✔</span>
<span class="token comment">// 1 x bacon ✘</span>
<span class="token comment">// 6 x eggs ✘</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>如上所述，例子中通过字面量方式创建了一个数组 <code>breakfastList</code>，它包含了三个 <code>ShoppingListItem</code> 实例，因此数组的类型也能被自动推导为 <code>[ShoppingListItem]</code>。在数组创建完之后，数组中第一个 <code>ShoppingListItem</code> 实例的名字从 <code>[Unnamed]</code> 更改为 <code>Orange juice</code>，并标记状态为已购买。打印数组中每个元素的描述显示了它们都已按照预期被赋值。</p> <h2 id="可失败构造器"><a href="#可失败构造器" class="header-anchor">#</a> 可失败构造器</h2> <p>有时，定义一个构造器可失败的类，结构体或者枚举是很有用的。这里所指的“失败” 指的是，如给构造器传入无效的形参，或缺少某种所需的外部资源，又或是不满足某种必要的条件等。</p> <p>为了妥善处理这种构造过程中可能会失败的情况。你可以在一个类，结构体或是枚举类型的定义中，添加一个或多个可失败构造器。其语法为在 <code>init</code> 关键字后面添加问号（<code>init?</code>）。</p> <blockquote><p>注意</p> <p>可失败构造器的参数名和参数类型，不能与其它非可失败构造器的参数名，及其参数类型相同。</p></blockquote> <p>可失败构造器会创建一个类型为自身类型的可选类型的对象。你通过 <code>return nil</code> 语句来表明可失败构造器在何种情况下应该 “失败”。</p> <blockquote><p>注意</p> <p>严格来说，构造器都不支持返回值。因为构造器本身的作用，只是为了确保对象能被正确构造。因此你只是用 <code>return nil</code> 表明可失败构造器构造失败，而不要用关键字 <code>return</code> 来表明构造成功。</p></blockquote> <p>例如，实现针对数字类型转换的可失败构造器。确保数字类型之间的转换能保持精确的值，使用这个 <code>init(exactly:)</code> 构造器。如果类型转换不能保持值不变，则这个构造器构造失败。</p> <div class="language-swift line-numbers-mode"><pre class="language-swift"><code><span class="token keyword">let</span> wholeNumber<span class="token punctuation">:</span> <span class="token class-name">Double</span> <span class="token operator">=</span> <span class="token number">12345.0</span>
<span class="token keyword">let</span> pi <span class="token operator">=</span> <span class="token number">3.14159</span>


<span class="token keyword">if</span> <span class="token keyword">let</span> valueMaintained <span class="token operator">=</span> <span class="token class-name">Int</span><span class="token punctuation">(</span>exactly<span class="token punctuation">:</span> wholeNumber<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;</span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">wholeNumber</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string"> conversion to Int maintains value of </span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">valueMaintained</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">// 打印“12345.0 conversion to Int maintains value of 12345”</span>


<span class="token keyword">let</span> valueChanged <span class="token operator">=</span> <span class="token class-name">Int</span><span class="token punctuation">(</span>exactly<span class="token punctuation">:</span> pi<span class="token punctuation">)</span>
<span class="token comment">// valueChanged 是 Int? 类型，不是 Int 类型</span>


<span class="token keyword">if</span> valueChanged <span class="token operator">==</span> <span class="token nil constant">nil</span> <span class="token punctuation">{</span>
    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;</span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">pi</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string"> conversion to Int does not maintain value&quot;</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">// 打印“3.14159 conversion to Int does not maintain value”</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>下例中，定义了一个名为 <code>Animal</code> 的结构体，其中有一个名为 <code>species</code> 的 <code>String</code> 类型的常量属性。同时该结构体还定义了一个接受一个名为 <code>species</code> 的 <code>String</code> 类型形参的可失败构造器。这个可失败构造器检查传入的<code>species</code> 值是否为一个空字符串。如果为空字符串，则构造失败。否则，<code>species</code> 属性被赋值，构造成功。</p> <div class="language-swift line-numbers-mode"><pre class="language-swift"><code><span class="token keyword">struct</span> <span class="token class-name">Animal</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> species<span class="token punctuation">:</span> <span class="token class-name">String</span>
    <span class="token keyword">init</span><span class="token operator">?</span><span class="token punctuation">(</span>species<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> species<span class="token punctuation">.</span>isEmpty <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token nil constant">nil</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span>species <span class="token operator">=</span> species
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>你可以通过该可失败构造器来尝试构建一个 <code>Animal</code> 的实例，并检查构造过程是否成功：</p> <div class="language-swift line-numbers-mode"><pre class="language-swift"><code><span class="token keyword">let</span> someCreature <span class="token operator">=</span> <span class="token class-name">Animal</span><span class="token punctuation">(</span>species<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">&quot;Giraffe&quot;</span></span><span class="token punctuation">)</span>
<span class="token comment">// someCreature 的类型是 Animal? 而不是 Animal</span>


<span class="token keyword">if</span> <span class="token keyword">let</span> giraffe <span class="token operator">=</span> someCreature <span class="token punctuation">{</span>
    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;An animal was initialized with a species of </span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">giraffe<span class="token punctuation">.</span>species</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">// 打印“An animal was initialized with a species of Giraffe”</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>如果你给该可失败构造器传入一个空字符串到形参 <code>species</code>，则会导致构造失败：</p> <div class="language-swift line-numbers-mode"><pre class="language-swift"><code><span class="token keyword">let</span> anonymousCreature <span class="token operator">=</span> <span class="token class-name">Animal</span><span class="token punctuation">(</span>species<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">&quot;&quot;</span></span><span class="token punctuation">)</span>
<span class="token comment">// anonymousCreature 的类型是 Animal?, 而不是 Animal</span>


<span class="token keyword">if</span> anonymousCreature <span class="token operator">==</span> <span class="token nil constant">nil</span> <span class="token punctuation">{</span>
    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;The anonymous creature could not be initialized&quot;</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">// 打印“The anonymous creature could not be initialized”</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><blockquote><p>注意</p> <p>检查空字符串的值（如 <code>&quot;&quot;</code>，而不是 <code>&quot;Giraffe&quot;</code> ）和检查值为 <code>nil</code> 的可选类型的字符串是两个完全不同的概念。上例中的空字符串（<code>&quot;&quot;</code>）其实是一个有效的，非可选类型的字符串。这里我们之所以让 <code>Animal</code> 的可失败构造器构造失败，只是因为对于 <code>Animal</code> 这个类的 <code>species</code> 属性来说，它更适合有一个具体的值，而不是空字符串。</p></blockquote> <h3 id="枚举类型的可失败构造器"><a href="#枚举类型的可失败构造器" class="header-anchor">#</a> 枚举类型的可失败构造器</h3> <p>你可以通过一个带一个或多个形参的可失败构造器来获取枚举类型中特定的枚举成员。如果提供的形参无法匹配任何枚举成员，则构造失败。</p> <p>下例中，定义了一个名为 <code>TemperatureUnit</code> 的枚举类型。其中包含了三个可能的枚举状态（<code>Kelvin</code>、<code>Celsius</code> 和 <code>Fahrenheit</code>），以及一个根据表示温度单位的 <code>Character</code> 值找出合适的枚举成员的可失败构造器：</p> <div class="language-swift line-numbers-mode"><pre class="language-swift"><code><span class="token keyword">enum</span> <span class="token class-name">TemperatureUnit</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token class-name">Kelvin</span><span class="token punctuation">,</span> <span class="token class-name">Celsius</span><span class="token punctuation">,</span> <span class="token class-name">Fahrenheit</span>
    <span class="token keyword">init</span><span class="token operator">?</span><span class="token punctuation">(</span>symbol<span class="token punctuation">:</span> <span class="token class-name">Character</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">switch</span> symbol <span class="token punctuation">{</span>
        <span class="token keyword">case</span> <span class="token string-literal"><span class="token string">&quot;K&quot;</span></span><span class="token punctuation">:</span>
            <span class="token keyword">self</span> <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token class-name">Kelvin</span>
        <span class="token keyword">case</span> <span class="token string-literal"><span class="token string">&quot;C&quot;</span></span><span class="token punctuation">:</span>
            <span class="token keyword">self</span> <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token class-name">Celsius</span>
        <span class="token keyword">case</span> <span class="token string-literal"><span class="token string">&quot;F&quot;</span></span><span class="token punctuation">:</span>
            <span class="token keyword">self</span> <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token class-name">Fahrenheit</span>
        <span class="token keyword">default</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token nil constant">nil</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>你可以利用该可失败构造器在三个枚举成员中选择合适的枚举成员，当形参不能和任何枚举成员相匹配时，则构造失败：</p> <div class="language-swift line-numbers-mode"><pre class="language-swift"><code><span class="token keyword">let</span> fahrenheitUnit <span class="token operator">=</span> <span class="token class-name">TemperatureUnit</span><span class="token punctuation">(</span>symbol<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">&quot;F&quot;</span></span><span class="token punctuation">)</span>
<span class="token keyword">if</span> fahrenheitUnit <span class="token operator">!=</span> <span class="token nil constant">nil</span> <span class="token punctuation">{</span>
    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;This is a defined temperature unit, so initialization succeeded.&quot;</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">// 打印“This is a defined temperature unit, so initialization succeeded.”</span>


<span class="token keyword">let</span> unknownUnit <span class="token operator">=</span> <span class="token class-name">TemperatureUnit</span><span class="token punctuation">(</span>symbol<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">&quot;X&quot;</span></span><span class="token punctuation">)</span>
<span class="token keyword">if</span> unknownUnit <span class="token operator">==</span> <span class="token nil constant">nil</span> <span class="token punctuation">{</span>
    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;This is not a defined temperature unit, so initialization failed.&quot;</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">// 打印“This is not a defined temperature unit, so initialization failed.”</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h3 id="带原始值的枚举类型的可失败构造器"><a href="#带原始值的枚举类型的可失败构造器" class="header-anchor">#</a> 带原始值的枚举类型的可失败构造器</h3> <p>带原始值的枚举类型会自带一个可失败构造器 <code>init?(rawValue:)</code>，该可失败构造器有一个合适的原始值类型的 <code>rawValue</code> 形参，选择找到的相匹配的枚举成员，找不到则构造失败。</p> <p>因此上面的 <code>TemperatureUnit</code> 的例子可以用原始值类型的 <code>Character</code> 和进阶的 <code>init?(rawValue:)</code> 构造器重写为：</p> <div class="language-swift line-numbers-mode"><pre class="language-swift"><code><span class="token keyword">enum</span> <span class="token class-name">TemperatureUnit</span><span class="token punctuation">:</span> <span class="token class-name">Character</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token class-name">Kelvin</span> <span class="token operator">=</span> <span class="token string-literal"><span class="token string">&quot;K&quot;</span></span><span class="token punctuation">,</span> <span class="token class-name">Celsius</span> <span class="token operator">=</span> <span class="token string-literal"><span class="token string">&quot;C&quot;</span></span><span class="token punctuation">,</span> <span class="token class-name">Fahrenheit</span> <span class="token operator">=</span> <span class="token string-literal"><span class="token string">&quot;F&quot;</span></span>
<span class="token punctuation">}</span>


<span class="token keyword">let</span> fahrenheitUnit <span class="token operator">=</span> <span class="token class-name">TemperatureUnit</span><span class="token punctuation">(</span>rawValue<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">&quot;F&quot;</span></span><span class="token punctuation">)</span>
<span class="token keyword">if</span> fahrenheitUnit <span class="token operator">!=</span> <span class="token nil constant">nil</span> <span class="token punctuation">{</span>
    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;This is a defined temperature unit, so initialization succeeded.&quot;</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">// 打印“This is a defined temperature unit, so initialization succeeded.”</span>


<span class="token keyword">let</span> unknownUnit <span class="token operator">=</span> <span class="token class-name">TemperatureUnit</span><span class="token punctuation">(</span>rawValue<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">&quot;X&quot;</span></span><span class="token punctuation">)</span>
<span class="token keyword">if</span> unknownUnit <span class="token operator">==</span> <span class="token nil constant">nil</span> <span class="token punctuation">{</span>
    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;This is not a defined temperature unit, so initialization failed.&quot;</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">// 打印“This is not a defined temperature unit, so initialization failed.”</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h3 id="构造失败的传递"><a href="#构造失败的传递" class="header-anchor">#</a> 构造失败的传递</h3> <p>类、结构体、枚举的可失败构造器可以横向代理到它们自己其他的可失败构造器。类似的，子类的可失败构造器也能向上代理到父类的可失败构造器。</p> <p>无论是向上代理还是横向代理，如果你代理到的其他可失败构造器触发构造失败，整个构造过程将立即终止，接下来的任何构造代码不会再被执行。</p> <blockquote><p>注意</p> <p>可失败构造器也可以代理到其它的不可失败构造器。通过这种方式，你可以增加一个可能的失败状态到现有的构造过程中。</p></blockquote> <p>下面这个例子，定义了一个名为 <code>CartItem</code> 的 <code>Product</code> 类的子类。这个类建立了一个在线购物车中的物品的模型，它有一个名为 <code>quantity</code> 的常量存储型属性，并确保该属性的值至少为 <code>1</code>：</p> <div class="language-swift line-numbers-mode"><pre class="language-swift"><code><span class="token keyword">class</span> <span class="token class-name">Product</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> name<span class="token punctuation">:</span> <span class="token class-name">String</span>
    <span class="token keyword">init</span><span class="token operator">?</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> name<span class="token punctuation">.</span>isEmpty <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token nil constant">nil</span> <span class="token punctuation">}</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>


<span class="token keyword">class</span> <span class="token class-name">CartItem</span><span class="token punctuation">:</span> <span class="token class-name">Product</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> quantity<span class="token punctuation">:</span> <span class="token class-name">Int</span>
    <span class="token keyword">init</span><span class="token operator">?</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span> quantity<span class="token punctuation">:</span> <span class="token class-name">Int</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> quantity <span class="token operator">&lt;</span> <span class="token number">1</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token nil constant">nil</span> <span class="token punctuation">}</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span>quantity <span class="token operator">=</span> quantity
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token keyword">init</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> name<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p><code>CartItem</code> 可失败构造器首先验证接收的 <code>quantity</code> 值是否大于等于 1 。倘若 <code>quantity</code> 值无效，则立即终止整个构造过程，返回失败结果，且不再执行余下代码。同样地，<code>Product</code> 的可失败构造器首先检查 <code>name</code> 值，假如 <code>name</code> 值为空字符串，则构造器立即执行失败。</p> <p>如果你通过传入一个非空字符串 <code>name</code> 以及一个值大于等于 1 的 <code>quantity</code> 来创建一个 <code>CartItem</code> 实例，那么构造方法能够成功被执行：</p> <div class="language-swift line-numbers-mode"><pre class="language-swift"><code><span class="token keyword">if</span> <span class="token keyword">let</span> twoSocks <span class="token operator">=</span> <span class="token class-name">CartItem</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">&quot;sock&quot;</span></span><span class="token punctuation">,</span> quantity<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;Item: </span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">twoSocks<span class="token punctuation">.</span>name</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">, quantity: </span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">twoSocks<span class="token punctuation">.</span>quantity</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">// 打印“Item: sock, quantity: 2”</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>倘若你以一个值为 0 的 <code>quantity</code> 来创建一个 <code>CartItem</code> 实例，那么将导致 <code>CartItem</code> 构造器失败：</p> <div class="language-swift line-numbers-mode"><pre class="language-swift"><code><span class="token keyword">if</span> <span class="token keyword">let</span> zeroShirts <span class="token operator">=</span> <span class="token class-name">CartItem</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">&quot;shirt&quot;</span></span><span class="token punctuation">,</span> quantity<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;Item: </span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">zeroShirts<span class="token punctuation">.</span>name</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">, quantity: </span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">zeroShirts<span class="token punctuation">.</span>quantity</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;Unable to initialize zero shirts&quot;</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">// 打印“Unable to initialize zero shirts”</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>同样地，如果你尝试传入一个值为空字符串的 <code>name</code> 来创建一个 <code>CartItem</code> 实例，那么将导致父类 <code>Product</code> 的构造过程失败：</p> <div class="language-swift line-numbers-mode"><pre class="language-swift"><code><span class="token keyword">if</span> <span class="token keyword">let</span> oneUnnamed <span class="token operator">=</span> <span class="token class-name">CartItem</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">&quot;&quot;</span></span><span class="token punctuation">,</span> quantity<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;Item: </span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">oneUnnamed<span class="token punctuation">.</span>name</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">, quantity: </span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">oneUnnamed<span class="token punctuation">.</span>quantity</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;Unable to initialize one unnamed product&quot;</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">// 打印“Unable to initialize one unnamed product”</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="重写一个可失败构造器"><a href="#重写一个可失败构造器" class="header-anchor">#</a> 重写一个可失败构造器</h3> <p>如同其它的构造器，你可以在子类中重写父类的可失败构造器。或者你也可以用子类的非可失败构造器重写一个父类的可失败构造器。这使你可以定义一个不会构造失败的子类，即使父类的构造器允许构造失败。</p> <p>注意，当你用子类的非可失败构造器重写父类的可失败构造器时，向上代理到父类的可失败构造器的唯一方式是对父类的可失败构造器的返回值进行强制解包。</p> <blockquote><p>注意</p> <p>你可以用非可失败构造器重写可失败构造器，但反过来却不行。</p></blockquote> <p>下例定义了一个名为 <code>Document</code> 的类。这个类模拟一个文档并可以用 <code>name</code> 属性来构造，属性的值必须为一个非空字符串或 <code>nil</code>，但不能是一个空字符串：</p> <div class="language-swift line-numbers-mode"><pre class="language-swift"><code><span class="token keyword">class</span> <span class="token class-name">Document</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> name<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token operator">?</span>
    <span class="token comment">// 该构造器创建了一个 name 属性的值为 nil 的 document 实例</span>
    <span class="token keyword">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token comment">// 该构造器创建了一个 name 属性的值为非空字符串的 document 实例</span>
    <span class="token keyword">init</span><span class="token operator">?</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> name<span class="token punctuation">.</span>isEmpty <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token nil constant">nil</span> <span class="token punctuation">}</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>下面这个例子，定义了一个 <code>Document</code> 类的子类 <code>AutomaticallyNamedDocument</code>。这个子类重写了所有父类引入的指定构造器。这些重写确保了无论是使用 <code>init()</code> 构造器，还是使用 <code>init(name:)</code> 构造器，在没有名字或者形参传入空字符串时，生成的实例中的 <code>name</code> 属性总有初始值 <code>&quot;[Untitled]&quot;</code>：</p> <div class="language-swift line-numbers-mode"><pre class="language-swift"><code><span class="token keyword">class</span> <span class="token class-name">AutomaticallyNamedDocument</span><span class="token punctuation">:</span> <span class="token class-name">Document</span> <span class="token punctuation">{</span>
    <span class="token keyword">override</span> <span class="token keyword">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token keyword">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string-literal"><span class="token string">&quot;[Untitled]&quot;</span></span>
    <span class="token punctuation">}</span>
    <span class="token keyword">override</span> <span class="token keyword">init</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token keyword">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> name<span class="token punctuation">.</span>isEmpty <span class="token punctuation">{</span>
            <span class="token keyword">self</span><span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string-literal"><span class="token string">&quot;[Untitled]&quot;</span></span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token keyword">self</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p><code>AutomaticallyNamedDocument</code> 用一个不可失败构造器 <code>init(name:)</code> 重写了父类的可失败构造器 <code>init?(name:)</code>。因为子类用另一种方式处理了空字符串的情况，所以不再需要一个可失败构造器，因此子类用一个不可失败构造器代替了父类的可失败构造器。</p> <p>你可以在子类的不可失败构造器中使用强制解包来调用父类的可失败构造器。比如，下面的 <code>UntitledDocument</code> 子类的 <code>name</code> 属性的值总是 <code>&quot;[Untitled]&quot;</code>，它在构造过程中使用了父类的可失败构造器 <code>init?(name:)</code>：</p> <div class="language-swift line-numbers-mode"><pre class="language-swift"><code><span class="token keyword">class</span> <span class="token class-name">UntitledDocument</span><span class="token punctuation">:</span> <span class="token class-name">Document</span> <span class="token punctuation">{</span>
    <span class="token keyword">override</span> <span class="token keyword">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token keyword">init</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">&quot;[Untitled]&quot;</span></span><span class="token punctuation">)</span><span class="token operator">!</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>在这个例子中，如果在调用父类的可失败构造器 <code>init?(name:)</code> 时传入的是空字符串，那么强制解包操作会引发运行时错误。不过，因为这里是通过字符串常量来调用它，构造器不会失败，所以并不会发生运行时错误。</p> <h3 id="init-可失败构造器"><a href="#init-可失败构造器" class="header-anchor">#</a> init! 可失败构造器</h3> <p>通常来说我们通过在 <code>init</code> 关键字后添加问号的方式（<code>init?</code>）来定义一个可失败构造器，但你也可以通过在 <code>init</code> 后面添加感叹号的方式来定义一个可失败构造器（<code>init!</code>），该可失败构造器将会构建一个对应类型的隐式解包可选类型的对象。</p> <p>你可以在 <code>init?</code> 中代理到 <code>init!</code>，反之亦然。你也可以用 <code>init?</code> 重写 <code>init!</code>，反之亦然。你还可以用 <code>init</code> 代理到 <code>init!</code>，不过，一旦 <code>init!</code> 构造失败，则会触发一个断言。</p> <h2 id="必要构造器"><a href="#必要构造器" class="header-anchor">#</a> 必要构造器</h2> <p>在类的构造器前添加 <code>required</code> 修饰符表明所有该类的子类都必须实现该构造器：</p> <div class="language-swift line-numbers-mode"><pre class="language-swift"><code><span class="token keyword">class</span> <span class="token class-name">SomeClass</span> <span class="token punctuation">{</span>
    <span class="token keyword">required</span> <span class="token keyword">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 构造器的实现代码</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>在子类重写父类的必要构造器时，必须在子类的构造器前也添加 <code>required</code> 修饰符，表明该构造器要求也应用于继承链后面的子类。在重写父类中必要的指定构造器时，不需要添加 <code>override</code> 修饰符：</p> <div class="language-swift line-numbers-mode"><pre class="language-swift"><code><span class="token keyword">class</span> <span class="token class-name">SomeSubclass</span><span class="token punctuation">:</span> <span class="token class-name">SomeClass</span> <span class="token punctuation">{</span>
    <span class="token keyword">required</span> <span class="token keyword">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 构造器的实现代码</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><blockquote><p>注意</p> <p>如果子类继承的构造器能满足必要构造器的要求，则无须在子类中显式提供必要构造器的实现。</p></blockquote> <h2 id="通过闭包或函数设置属性的默认值"><a href="#通过闭包或函数设置属性的默认值" class="header-anchor">#</a> 通过闭包或函数设置属性的默认值</h2> <p>如果某个存储型属性的默认值需要一些自定义或设置，你可以使用闭包或全局函数为其提供定制的默认值。每当某个属性所在类型的新实例被构造时，对应的闭包或函数会被调用，而它们的返回值会当做默认值赋值给这个属性。</p> <p>这种类型的闭包或函数通常会创建一个跟属性类型相同的临时变量，然后修改它的值以满足预期的初始状态，最后返回这个临时变量，作为属性的默认值。</p> <p>下面模板介绍了如何用闭包为属性提供默认值：</p> <div class="language-swift line-numbers-mode"><pre class="language-swift"><code><span class="token keyword">class</span> <span class="token class-name">SomeClass</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> someProperty<span class="token punctuation">:</span> <span class="token class-name">SomeType</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token comment">// 在这个闭包中给 someProperty 创建一个默认值</span>
        <span class="token comment">// someValue 必须和 SomeType 类型相同</span>
        <span class="token keyword">return</span> someValue
    <span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>注意闭包结尾的花括号后面接了一对空的小括号。这用来告诉 Swift 立即执行此闭包。如果你忽略了这对括号，相当于将闭包本身作为值赋值给了属性，而不是将闭包的返回值赋值给属性。</p> <blockquote><p>注意</p> <p>如果你使用闭包来初始化属性，请记住在闭包执行时，实例的其它部分都还没有初始化。这意味着你不能在闭包里访问其它属性，即使这些属性有默认值。同样，你也不能使用隐式的 <code>self</code> 属性，或者调用任何实例方法。</p></blockquote> <p>下面例子中定义了一个结构体 <code>Chessboard</code>，它构建了西洋跳棋游戏的棋盘，西洋跳棋游戏在一副黑白格交替的 8 x 8 的棋盘中进行的：</p> <p><img src="https://cdn.jsdelivr.net/gh/zhmbo/static@master/img/20201111104935.png" alt="img"></p> <p>西洋跳棋棋盘</p> <p>为了呈现这副游戏棋盘，<code>Chessboard</code> 结构体定义了一个属性 <code>boardColors</code>，它是一个包含 <code>64</code> 个 <code>Bool</code> 值的数组。在数组中，值为 <code>true</code> 的元素表示一个黑格，值为 <code>false</code> 的元素表示一个白格。数组中第一个元素代表棋盘上左上角的格子，最后一个元素代表棋盘上右下角的格子。</p> <p><code>boardColors</code> 数组是通过一个闭包来初始化并设置颜色值的：</p> <div class="language-swift line-numbers-mode"><pre class="language-swift"><code><span class="token keyword">struct</span> <span class="token class-name">Chessboard</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> boardColors<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token class-name">Bool</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> temporaryBoard <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token class-name">Bool</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">var</span> isBlack <span class="token operator">=</span> <span class="token boolean">false</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token number">1</span><span class="token operator">...</span><span class="token number">8</span> <span class="token punctuation">{</span>
            <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token number">1</span><span class="token operator">...</span><span class="token number">8</span> <span class="token punctuation">{</span>
                temporaryBoard<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>isBlack<span class="token punctuation">)</span>
                isBlack <span class="token operator">=</span> <span class="token operator">!</span>isBlack
            <span class="token punctuation">}</span>
            isBlack <span class="token operator">=</span> <span class="token operator">!</span>isBlack
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> temporaryBoard
    <span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">func</span> <span class="token function-definition function">squareIsBlackAt</span><span class="token punctuation">(</span>row<span class="token punctuation">:</span> <span class="token class-name">Int</span><span class="token punctuation">,</span> column<span class="token punctuation">:</span> <span class="token class-name">Int</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token class-name">Bool</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> boardColors<span class="token punctuation">[</span><span class="token punctuation">(</span>row <span class="token operator">*</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">+</span> column<span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>每当一个新的 <code>Chessboard</code> 实例被创建时，赋值闭包则会被执行，<code>boardColors</code> 的默认值会被计算出来并返回。上面例子中描述的闭包将计算出棋盘中每个格子对应的颜色，并将这些值保存到一个临时数组 <code>temporaryBoard</code> 中，最后在构建完成时将此数组作为闭包返回值返回。这个返回的数组会保存到 <code>boardColors</code> 中，并可以通过工具函数 <code>squareIsBlackAtRow</code> 来查询：</p> <div class="language-swift line-numbers-mode"><pre class="language-swift"><code><span class="token keyword">let</span> board <span class="token operator">=</span> <span class="token class-name">Chessboard</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span>board<span class="token punctuation">.</span><span class="token function">squareIsBlackAt</span><span class="token punctuation">(</span>row<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> column<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">// 打印“true”</span>
<span class="token function">print</span><span class="token punctuation">(</span>board<span class="token punctuation">.</span><span class="token function">squareIsBlackAt</span><span class="token punctuation">(</span>row<span class="token punctuation">:</span> <span class="token number">7</span><span class="token punctuation">,</span> column<span class="token punctuation">:</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">// 打印“false”</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></div></div> <div class="page-edit"><!----> <!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2024/07/30, 18:07:00</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/pages/09b0f4/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">继承</div></a> <a href="/pages/c40911/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">解析过程</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/pages/09b0f4/" class="prev">继承</a></span> <span class="next"><a href="/pages/c40911/">解析过程</a>→
      </span></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/archives/" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/pages/742912/"><div>Homebrew+RVM+Ruby+CocoaPods</div></a> <span>11-23</span></dt></dl><dl><dd>02</dd> <dt><a href="/pages/81af2e/"><div>iOS13生命周期</div></a> <span>11-14</span></dt></dl><dl><dd>03</dd> <dt><a href="/pages/258164/"><div>《Swift编程语言》- 语法总结</div></a> <span>11-11</span></dt></dl> <dl><dd></dd> <dt><a href="/archives/" class="more">更多文章&gt;</a></dt></dl></div></div> <div class="comments-wrapper"><!----></div> </main></div> <!----> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">跟随系统</li><li class="iconfont icon-rijianmoshi">浅色模式</li><li class="iconfont icon-yejianmoshi">深色模式</li><li class="iconfont icon-yuedu">阅读模式</li></ul></div></div> <div class="body-bg" style="background:url() center center / cover no-repeat;opacity:0.5;filter:grayscale(100%);"></div> <!----> <div></div></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.f91ba302.js" defer></script><script src="/assets/js/2.dd713b59.js" defer></script><script src="/assets/js/3.069de0ac.js" defer></script><script src="/assets/js/26.192e5aa3.js" defer></script>
  </body>
</html>